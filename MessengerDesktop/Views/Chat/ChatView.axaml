<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:shared="using:MessengerShared.DTO"
             xmlns:controls="using:MessengerDesktop.Controls"
             xmlns:views="using:MessengerDesktop.Views"
             xmlns:chat="using:MessengerDesktop.Views.Chat"
             xmlns:conv="using:MessengerDesktop.Converters"
             xmlns:sys="using:System"
             x:Class="MessengerDesktop.Views.Chat.ChatView"
             xmlns:vm="clr-namespace:MessengerDesktop.ViewModels.Chat"
             x:DataType="vm:ChatViewModel"
             xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
             x:Name="Root"
             Design.Width="1280" Design.Height="720"
             Background="Transparent">

	<UserControl.Styles>
		<Style Selector="views|ChatInfoPanel">
			<Setter Property="Width" Value="320"/>
			<Setter Property="ClipToBounds" Value="True"/>
			<Setter Property="Margin" Value="-320,0,0,0"/>
			<Setter Property="Transitions">
				<Transitions>
					<ThicknessTransition Property="Margin" Duration="0:0:0.2" Easing="CubicEaseOut"/>
				</Transitions>
			</Setter>
		</Style>
		<Style Selector="views|ChatInfoPanel[IsVisible=true]">
			<Setter Property="Margin" Value="0"/>
		</Style>

		<Style Selector="ToggleButton.IconButton">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Width" Value="40"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="VerticalContentAlignment" Value="Center"/>
			<Setter Property="HorizontalContentAlignment" Value="Center"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Style Selector="^:checked /template/ ContentPresenter#PART_ContentPresenter">
				<Setter Property="Background" Value="Transparent"/>
				<Setter Property="Foreground" Value="{DynamicResource Accent}"/>
			</Style>
			<Style Selector="^:checked">
				<Setter Property="Foreground" Value="{DynamicResource Accent}"/>
			</Style>
			<Style Selector="^:pointerover /template/ ContentPresenter#PART_ContentPresenter">
				<Setter Property="Background" Value="#22FFFFFF"/>
			</Style>
			<Style Selector="^:disabled">
				<Setter Property="Opacity" Value="0.5"/>
			</Style>
		</Style>

		<Style Selector="Button.EmojiButton">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="4"/>
			<Setter Property="MinWidth" Value="36"/>
			<Setter Property="MinHeight" Value="36"/>
			<Setter Property="FontSize" Value="20"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="CornerRadius" Value="6"/>
		</Style>
		<Style Selector="Button.EmojiButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="Background" Value="#22FFFFFF"/>
		</Style>

		<Style Selector="Border.OwnMessageBubble">
			<Setter Property="Background" Value="{DynamicResource Accent}"/>
			<Setter Property="CornerRadius" Value="16,4,16,16"/>
		</Style>

		<Style Selector="Border.OtherMessageBubble">
			<Setter Property="Background" Value="{DynamicResource PrimaryBG}"/>
			<Setter Property="CornerRadius" Value="4,16,16,16"/>
		</Style>

		<!-- Ð¡Ñ‚Ð¸Ð»ÑŒ Ð´Ð»Ñ Ð¿Ð¾Ð´ÑÐ²ÐµÑ‚ÐºÐ¸ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
		<Style Selector="Border.MessageHighlight">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.3"/>
				</Transitions>
			</Setter>
		</Style>
		<Style Selector="Border.MessageHighlight.Highlighted">
			<Setter Property="Background" Value="#44FFD700"/>
		</Style>

		<!-- Ð¡Ñ‚Ð¸Ð»ÑŒ Ð´Ð»Ñ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð¿Ð¾Ð¸ÑÐºÐ° -->
		<Style Selector="Button.SearchResultItem">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="16,12"/>
			<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="CornerRadius" Value="8"/>
		</Style>
		<Style Selector="Button.SearchResultItem:pointerover /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource PrimaryBG}"/>
		</Style>
	</UserControl.Styles>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="Auto"/>
		</Grid.ColumnDefinitions>

		<Border Grid.Column="0" CornerRadius="16" Background="{DynamicResource SecondaryBG}">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<!-- Ð¨Ð°Ð¿ÐºÐ° -->
					<RowDefinition Height="Auto"/>
					<!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð¿Ð¾Ð¸ÑÐºÐ° -->
					<RowDefinition Height="*"/>
					<!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ (ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¸Ð»Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹) -->
					<RowDefinition Height="Auto"/>
					<!-- Ð’Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
				</Grid.RowDefinitions>

				<!-- ==================== Ð¨ÐÐŸÐšÐ Ð§ÐÐ¢Ð ==================== -->
				<Border Grid.Row="0"
                        BorderBrush="{DynamicResource BorderDefault}"
                        BorderThickness="0,0,0,1"
                        Padding="16,0"
                        ZIndex="10">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="12">
							<TextBlock Text="{Binding Chat.Name}"
                                       FontWeight="SemiBold"
                                       FontSize="18"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource TextPrimary}"/>
						</StackPanel>

						<Border Grid.Column="2"
                                HorizontalAlignment="Right"
                                Background="{DynamicResource PrimaryBG}"
                                CornerRadius="4"
                                Margin="8">
							<StackPanel Orientation="Horizontal">
								<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾Ð¸ÑÐºÐ° -->
								<ToggleButton Classes="IconButton"
                                              ToolTip.Tip="ÐŸÐ¾Ð¸ÑÐº"
                                              CornerRadius="4,0,0,4"
                                              IsChecked="{Binding IsSearchMode}">
									<Path Data="{StaticResource SearchIcon}"
                                          Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"
                                          Width="20" Height="20"
                                          Stretch="Uniform"/>
								</ToggleButton>

								<ToggleButton Classes="IconButton"
                                              ToolTip.Tip="Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÐºÐ°Ð½Ð°Ð»Ðµ"
                                              CornerRadius="0"
                                              IsChecked="{Binding IsInfoPanelOpen}">
									<Path Data="{StaticResource PanelRight}"
                                          Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}"
                                          Width="20" Height="20"
                                          Stretch="Uniform"/>
								</ToggleButton>

								<Button Classes="IconButton"
                                        ToolTip.Tip="ÐœÐµÐ½ÑŽ"
                                        CornerRadius="0,4,4,0">
									<Button.Flyout>
										<MenuFlyout Placement="BottomEdgeAlignedRight">
											<MenuItem Header="Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¾Ð¿Ñ€Ð¾Ñ" Command="{Binding OpenCreatePollCommand}">
												<MenuItem.IsVisible>
													<MultiBinding Converter="{conv:MultiConverter Name=BooleanAnd}">
														<Binding Path="IsGroupChat"/>
														<Binding Path="" Converter="{conv:Converter Name=HasRole}" ConverterParameter="Admin"/>
													</MultiBinding>
												</MenuItem.IsVisible>
											</MenuItem>
											<MenuItem Header="Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ñ‡Ð°Ñ‚Ð°" Command="{Binding LeaveChatCommand}" Foreground="Red"/>
										</MenuFlyout>
									</Button.Flyout>
									<Path Margin="10,0,0,0"
                                          Data="{StaticResource Options}"
                                          Width="20" Height="20"
                                          Fill="{DynamicResource TextPrimary}"
                                          Stretch="Uniform"/>
								</Button>
							</StackPanel>
						</Border>
					</Grid>
				</Border>

				<!-- ==================== Ð”Ð•ÐšÐžÐ ÐÐ¢Ð˜Ð’ÐÐ«Ð™ Ð¤ÐžÐ ==================== -->
				<Panel Grid.Row="2" Grid.RowSpan="2">
					<Border Opacity="0.4">
						<Border.Background>
							<LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
								<GradientStop Color="{DynamicResource TopBg}" Offset="0"/>
								<GradientStop Color="{DynamicResource BaseBg}" Offset="1"/>
							</LinearGradientBrush>
						</Border.Background>
					</Border>

					<Canvas IsHitTestVisible="False" Opacity="0.03">
						<Ellipse Width="60" Height="60" Fill="{DynamicResource TextPrimary}" Canvas.Left="50" Canvas.Top="100"/>
						<Ellipse Width="40" Height="40" Fill="{DynamicResource TextPrimary}" Canvas.Left="200" Canvas.Top="50"/>
						<Ellipse Width="30" Height="30" Fill="{DynamicResource TextPrimary}" Canvas.Left="350" Canvas.Top="180"/>
						<Ellipse Width="50" Height="50" Fill="{DynamicResource TextPrimary}" Canvas.Left="500" Canvas.Top="80"/>
						<Ellipse Width="35" Height="35" Fill="{DynamicResource TextPrimary}" Canvas.Left="150" Canvas.Top="300"/>
						<Ellipse Width="45" Height="45" Fill="{DynamicResource TextPrimary}" Canvas.Left="400" Canvas.Top="350"/>
						<Ellipse Width="25" Height="25" Fill="{DynamicResource TextPrimary}" Canvas.Left="600" Canvas.Top="200"/>
						<Ellipse Width="55" Height="55" Fill="{DynamicResource TextPrimary}" Canvas.Left="700" Canvas.Top="400"/>
					</Canvas>
				</Panel>		

				<!-- ==================== ÐžÐ‘Ð›ÐÐ¡Ð¢Ð¬ Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð™ ==================== -->
				<Panel Grid.Row="2">
					<controls:ChatMessagesSkeleton IsVisible="{Binding IsInitialLoading}"/>
					<ScrollViewer Name="MessagesScrollViewer"
								  Classes="MessagesScrollbar"
                                  VerticalScrollBarVisibility="Auto"
                                  Margin="0,8"
                                  Padding="16,0"
								  IsVisible="{Binding !IsInitialLoading}">
						<ItemsControl ItemsSource="{Binding Messages}" x:Name="MessagesList">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel Spacing="2"/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="vm:MessageViewModel">
									<!-- ÐžÐ±Ñ‘Ñ€Ñ‚ÐºÐ° Ñ Ð¿Ð¾Ð´ÑÐ²ÐµÑ‚ÐºÐ¾Ð¹ -->
									<Border Classes="MessageHighlight"
                                            Classes.Highlighted="{Binding IsHighlighted}"
                                            Padding="4,2">
										<Grid Margin="0,1">
											<Grid.ColumnDefinitions>
												<!-- ÐÐ²Ð°Ñ‚Ð°Ñ€ ÑÐ»ÐµÐ²Ð° -->
												<ColumnDefinition Width="44"/>
												<!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
												<ColumnDefinition Width="*"/>
												<!-- ÐžÑ‚ÑÑ‚ÑƒÐ¿ ÑÐ¿Ñ€Ð°Ð²Ð° -->
												<ColumnDefinition Width="60"/>
											</Grid.ColumnDefinitions>

											<!-- ===== ÐÐ’ÐÐ¢ÐÐ  ===== -->
											<Panel Grid.Column="0" VerticalAlignment="Bottom" Margin="0,0,0,2">
												<!-- ÐÐ²Ð°Ñ‚Ð°Ñ€ -->
												<Button VerticalAlignment="Bottom"
														IsVisible="{Binding ShowSenderName}"
														Command="{Binding DataContext.OpenProfileCommand, ElementName=Root}"
														CommandParameter="{Binding SenderId}"
														Height="36" Width="36"
														Padding="0"
														BorderThickness="0"
														Background="Transparent"
														ToolTip.Tip="{Binding SenderName}"
														Cursor="Hand">
													<controls:AvatarControl Classes="Small"
																			Source="{Binding SenderAvatarUrl}"
																			DisplayName="{Binding SenderName}"
																			ShowOnlineIndicator="False"/>
												</Button>

												<!-- Ð’Ñ€ÐµÐ¼Ñ ÑÐ»ÐµÐ²Ð° ÐºÐ¾Ð³Ð´Ð° Ð°Ð²Ð°Ñ‚Ð°Ñ€ ÑÐºÑ€Ñ‹Ñ‚ -->
												<TextBlock Text="{Binding CreatedAt, StringFormat=HH:mm}"
														   FontSize="10"
														   Foreground="{DynamicResource TextSecondary}"
														   Opacity="0.5"
														   HorizontalAlignment="Center"
														   VerticalAlignment="Top"
														   Margin="0,6,0,0"
														   IsVisible="{Binding ShowSenderName, Converter={x:Static BoolConverters.Not}}"/>
											</Panel>
											<!-- ===== ÐžÐ¡ÐÐžÐ’ÐÐžÐ™ ÐšÐžÐÐ¢Ð•ÐÐ¢ Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð¯ ===== -->
											<StackPanel Grid.Column="1"
                                                        HorizontalAlignment="Left"
                                                        Margin="6,0,0,0"
                                                        MaxWidth="560">

												<!-- Ð˜Ð¼Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÐ»Ñ Ð¸ Ð²Ñ€ÐµÐ¼Ñ -->
												<Button Background="Transparent"
                                                        BorderThickness="0"
                                                        Padding="14,0,14,4"
                                                        IsVisible="{Binding ShowSenderName}"
                                                        Command="{Binding DataContext.OpenProfileCommand, ElementName=Root}"
                                                        CommandParameter="{Binding SenderId}"
                                                        HorizontalAlignment="Left"
                                                        Cursor="Hand">
													<StackPanel Orientation="Horizontal" Spacing="10">
														<TextBlock Text="{Binding SenderName}"
                                                                   FontWeight="SemiBold"
                                                                   FontSize="13"
                                                                   Foreground="{DynamicResource Accent}"/>
														<TextBlock Text="{Binding CreatedAt, Converter={conv:Converter Name=MessageTime}}"
                                                                   FontSize="12"
                                                                   Foreground="{DynamicResource TextSecondary}"
                                                                   Opacity="0.6"
                                                                   VerticalAlignment="Center"/>
													</StackPanel>
												</Button>

												<!-- ÐŸÑƒÐ·Ñ‹Ñ€ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
												<Border Background="{DynamicResource PrimaryBG}"
                                                        CornerRadius="4,16,16,16"
                                                        Padding="14,10"
                                                        MinWidth="48">
													<Border.BoxShadow>
														<BoxShadows>0 1 4 0 #12000000</BoxShadows>
													</Border.BoxShadow>

													<StackPanel Spacing="8">

														<!-- Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
														<SelectableTextBlock Text="{Binding Content}"
                                                                              Foreground="{DynamicResource TextPrimary}"
                                                                              TextWrapping="Wrap"
                                                                              FontSize="15"
                                                                              LineHeight="22"
                                                                              IsVisible="{Binding Content, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

														<!-- ===== Ð’Ð›ÐžÐ–Ð•ÐÐÐ«Ð• Ð¤ÐÐ™Ð›Ð« ===== -->
														<ItemsControl ItemsSource="{Binding FileViewModels}"
                                                                      IsVisible="{Binding HasFiles}">
															<ItemsControl.ItemsPanel>
																<ItemsPanelTemplate>
																	<StackPanel Spacing="6"/>
																</ItemsPanelTemplate>
															</ItemsControl.ItemsPanel>
															<ItemsControl.ItemTemplate>
																<DataTemplate x:DataType="vm:MessageFileViewModel">
																	<Grid>
																		<!-- ===== Ð˜Ð—ÐžÐ‘Ð ÐÐ–Ð•ÐÐ˜Ð• ===== -->
																		<Border CornerRadius="10"
                                                                                ClipToBounds="True"
                                                                                MaxWidth="320"
                                                                                MaxHeight="320"
                                                                                HorizontalAlignment="Left"
                                                                                IsVisible="{Binding IsImage}">
																			<Grid>
																				<Image Stretch="Uniform"
                                                                                       asyncImageLoader:ImageLoader.Source="{Binding Url}"/>

																				<!-- ÐžÐ²ÐµÑ€Ð»ÐµÐ¹ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸ Ð´Ð»Ñ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ -->
																				<Border Background="#66000000"
                                                                                        CornerRadius="10"
                                                                                        IsVisible="{Binding $parent[Border].IsPointerOver}"
                                                                                        HorizontalAlignment="Stretch"
                                                                                        VerticalAlignment="Stretch">
																					<StackPanel Orientation="Horizontal"
                                                                                                HorizontalAlignment="Center"
                                                                                                VerticalAlignment="Center"
                                                                                                Spacing="8">
																						<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ -->
																						<Button Classes="IconButton"
                                                                                                Command="{Binding DownloadCommand}"
                                                                                                IsVisible="{Binding !IsDownloaded}"
                                                                                                ToolTip.Tip="Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ"
                                                                                                Width="40" Height="40"
                                                                                                Background="#88000000"
                                                                                                CornerRadius="20">
																							<Path Data="{StaticResource DownloadIcon}"
                                                                                                  Fill="White"
                                                                                                  Width="18" Height="18"
                                                                                                  Stretch="Uniform"/>
																						</Button>

																						<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ñ -->
																						<Button Classes="IconButton"
                                                                                                Command="{Binding OpenFileCommand}"
                                                                                                IsVisible="{Binding IsDownloaded}"
                                                                                                ToolTip.Tip="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ"
                                                                                                Width="40" Height="40"
                                                                                                Background="#88000000"
                                                                                                CornerRadius="20">
																							<Path Data="{StaticResource OpenIcon}"
                                                                                                  Fill="White"
                                                                                                  Width="18" Height="18"
                                                                                                  Stretch="Uniform"/>
																						</Button>
																					</StackPanel>
																				</Border>
																			</Grid>
																		</Border>

																		<!-- ===== Ð¤ÐÐ™Ð› (ÐÐ• Ð˜Ð—ÐžÐ‘Ð ÐÐ–Ð•ÐÐ˜Ð•) ===== -->
																		<Border Background="{DynamicResource SecondaryBG}"
                                                                                CornerRadius="10"
                                                                                Padding="12,10"
                                                                                HorizontalAlignment="Left"
                                                                                MinWidth="240"
                                                                                MaxWidth="320"
                                                                                IsVisible="{Binding !IsImage}">
																			<Grid RowDefinitions="Auto,Auto">
																				<!-- ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ -->
																				<Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
																					<!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° -->
																					<Border Grid.Column="0"
                                                                                            Width="44" Height="44"
                                                                                            CornerRadius="10"
                                                                                            Background="{DynamicResource Accent}">
																						<TextBlock Text="{Binding FileIcon}"
                                                                                                   FontSize="20"
                                                                                                   HorizontalAlignment="Center"
                                                                                                   VerticalAlignment="Center"/>
																					</Border>

																					<!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ñ€Ð°Ð·Ð¼ÐµÑ€ -->
																					<StackPanel Grid.Column="1"
                                                                                                Margin="12,0,8,0"
                                                                                                VerticalAlignment="Center">
																						<TextBlock Text="{Binding FileName}"
                                                                                                   Foreground="{DynamicResource TextPrimary}"
                                                                                                   FontWeight="Medium"
                                                                                                   FontSize="13"
                                                                                                   TextTrimming="CharacterEllipsis"
                                                                                                   MaxWidth="160"/>
																						<StackPanel Orientation="Horizontal" Spacing="8">
																							<TextBlock Text="{Binding FileSizeFormatted}"
                                                                                                       FontSize="11"
                                                                                                       Foreground="{DynamicResource TextSecondary}"
                                                                                                       IsVisible="{Binding FileSizeFormatted, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
																							<TextBlock Text="{Binding ContentType}"
                                                                                                       FontSize="11"
                                                                                                       Foreground="{DynamicResource TextSecondary}"
                                                                                                       Opacity="0.7"/>
																						</StackPanel>
																					</StackPanel>

																					<!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
																					<StackPanel Grid.Column="2"
                                                                                                Orientation="Horizontal"
                                                                                                VerticalAlignment="Center">

																						<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ -->
																						<Button Classes="IconButton"
                                                                                                Command="{Binding DownloadCommand}"
                                                                                                IsVisible="{Binding !IsDownloading}"
                                                                                                ToolTip.Tip="Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ"
                                                                                                Width="36" Height="36"
                                                                                                CornerRadius="8"
                                                                                                Background="{DynamicResource PrimaryBG}">
																							<Panel>
																								<!-- Ð˜ÐºÐ¾Ð½ÐºÐ° ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ -->
																								<Path Data="{StaticResource DownloadIcon}"
                                                                                                      Fill="{DynamicResource TextSecondary}"
                                                                                                      Width="16" Height="16"
                                                                                                      Stretch="Uniform"
                                                                                                      IsVisible="{Binding !IsDownloaded}"/>

																								<!-- Ð“Ð°Ð»Ð¾Ñ‡ÐºÐ° (ÐºÐ¾Ð³Ð´Ð° ÑÐºÐ°Ñ‡Ð°Ð½) -->
																								<Path Data="{StaticResource CheckIcon}"
                                                                                                      Fill="{DynamicResource SuccessColor}"
                                                                                                      Width="16" Height="16"
                                                                                                      Stretch="Uniform"
                                                                                                      IsVisible="{Binding IsDownloaded}"/>
																							</Panel>
																						</Button>

																						<!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
																						<Grid Width="36" Height="36"
                                                                                              IsVisible="{Binding IsDownloading}">
																							<!-- ÐšÑ€ÑƒÐ³Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ -->
																							<controls:CircularProgress Value="{Binding DownloadProgress}"
                                                                                                                       Maximum="100"
                                                                                                                       StrokeWidth="3"
                                                                                                                       Size="28"
                                                                                                                       Foreground="{DynamicResource Accent}"/>

																							<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ -->
																							<Button Classes="IconButton"
                                                                                                    Command="{Binding CancelDownloadCommand}"
                                                                                                    ToolTip.Tip="ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"
                                                                                                    Width="20" Height="20"
                                                                                                    Background="Transparent"
                                                                                                    CornerRadius="10">
																								<TextBlock Text="âœ•"
                                                                                                           FontSize="10"
                                                                                                           Foreground="{DynamicResource TextSecondary}"
                                                                                                           HorizontalAlignment="Center"
                                                                                                           VerticalAlignment="Center"/>
																							</Button>
																						</Grid>

																						<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ñ (ÐºÐ¾Ð³Ð´Ð° ÑÐºÐ°Ñ‡Ð°Ð½) -->
																						<Button Classes="IconButton"
                                                                                                Command="{Binding OpenFileCommand}"
                                                                                                IsVisible="{Binding IsDownloaded}"
                                                                                                ToolTip.Tip="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»"
                                                                                                Width="36" Height="36"
                                                                                                CornerRadius="8"
                                                                                                Margin="4,0,0,0"
                                                                                                Background="{DynamicResource PrimaryBG}">
																							<Path Data="{StaticResource OpenIcon}"
                                                                                                  Fill="{DynamicResource Accent}"
                                                                                                  Width="16" Height="16"
                                                                                                  Stretch="Uniform"/>
																						</Button>
																					</StackPanel>
																				</Grid>

																				<!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ-Ð±Ð°Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
																				<ProgressBar Grid.Row="1"
                                                                                             Value="{Binding DownloadProgress}"
                                                                                             Maximum="100"
                                                                                             Minimum="0"
                                                                                             Height="3"
                                                                                             Margin="0,8,0,0"
                                                                                             CornerRadius="2"
                                                                                             IsVisible="{Binding IsDownloading}"
                                                                                             Foreground="{DynamicResource Accent}"
                                                                                             Background="{DynamicResource PrimaryBG}"/>

																				<!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ -->
																				<Border Grid.Row="1"
                                                                                        Background="#33FF4444"
                                                                                        CornerRadius="6"
                                                                                        Padding="8,4"
                                                                                        Margin="0,8,0,0"
                                                                                        IsVisible="{Binding HasError}">
																					<Grid ColumnDefinitions="*,Auto">
																						<TextBlock Grid.Column="0"
                                                                                                   Text="{Binding ErrorMessage}"
                                                                                                   Foreground="#FF6666"
                                                                                                   FontSize="11"
                                                                                                   TextWrapping="Wrap"
                                                                                                   VerticalAlignment="Center"/>
																						<Button Grid.Column="1"
                                                                                                Content="â†»"
                                                                                                Command="{Binding RetryDownloadCommand}"
                                                                                                ToolTip.Tip="ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ"
                                                                                                FontSize="14"
                                                                                                Padding="4"
                                                                                                Background="Transparent"
                                                                                                Foreground="{DynamicResource Accent}"
                                                                                                Margin="8,0,0,0"/>
																					</Grid>
																				</Border>
																			</Grid>
																		</Border>
																	</Grid>
																</DataTemplate>
															</ItemsControl.ItemTemplate>
														</ItemsControl>

														<!-- ===== ÐžÐŸÐ ÐžÐ¡ ===== -->
														<ContentControl Content="{Binding Poll, Converter={conv:Converter Name=PollToPollViewModel}}"
                                                                        IsVisible="{Binding Poll, Converter={x:Static ObjectConverters.IsNotNull}}"
                                                                        HorizontalAlignment="Left">
															<ContentControl.ContentTemplate>
																<DataTemplate x:DataType="vm:PollViewModel">
																	<Border Background="{DynamicResource SecondaryBG}"
                                                                            CornerRadius="12"
                                                                            Padding="14"
                                                                            Width="280">
																		<StackPanel Spacing="10">
																			<!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¾Ð¿Ñ€Ð¾ÑÐ° -->
																			<StackPanel Spacing="2">
																				<StackPanel Orientation="Horizontal" Spacing="6">
																					<TextBlock Text="ðŸ“Š"
                                                                                               FontSize="14"
                                                                                               VerticalAlignment="Center"/>
																					<TextBlock Text="ÐžÐ¿Ñ€Ð¾Ñ"
                                                                                               FontSize="12"
                                                                                               FontWeight="SemiBold"
                                                                                               Foreground="{DynamicResource Accent}"/>
																				</StackPanel>
																				<TextBlock Text="{Binding IsAnonymous, 
                                                                                    Converter={conv:Converter Name=BoolToString}, 
                                                                                    ConverterParameter='ÐÐ½Ð¾Ð½Ð¸Ð¼Ð½Ð¾Ðµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ|ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ'}"
                                                                                           FontSize="11"
                                                                                           Foreground="{DynamicResource TextSecondary}"
                                                                                           Opacity="0.6"/>
																			</StackPanel>

																			<!-- Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð² -->
																			<ItemsControl ItemsSource="{Binding Options}">
																				<ItemsControl.ItemTemplate>
																					<DataTemplate x:DataType="vm:PollOptionViewModel">
																						<Border Background="{DynamicResource PrimaryBG}"
                                                                                                CornerRadius="8"
                                                                                                Padding="12,10"
                                                                                                Margin="0,2"
                                                                                                Cursor="Hand">
																							<Grid ColumnDefinitions="*,Auto">
																								<RadioButton Grid.Column="0"
                                                                                                             IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                                                             Content="{Binding OptionText}"
                                                                                                             IsEnabled="{Binding CanVote}"
                                                                                                             Foreground="{DynamicResource TextPrimary}"
                                                                                                             FontSize="13"/>

																								<TextBlock Grid.Column="1"
                                                                                                           Text="{Binding VotesPercentage, StringFormat={}{0:0}%}"
                                                                                                           Foreground="{DynamicResource Accent}"
                                                                                                           FontSize="12"
                                                                                                           FontWeight="SemiBold"
                                                                                                           VerticalAlignment="Center"
                                                                                                           Margin="8,0,0,0"
                                                                                                           IsVisible="{Binding CanVote, Converter={x:Static BoolConverters.Not}}"/>
																							</Grid>
																						</Border>
																					</DataTemplate>
																				</ItemsControl.ItemTemplate>
																			</ItemsControl>

																			<!-- Ð¤ÑƒÑ‚ÐµÑ€ Ð¾Ð¿Ñ€Ð¾ÑÐ° -->
																			<Grid ColumnDefinitions="*,Auto">
																				<TextBlock Grid.Column="0"
                                                                                           Text="{Binding TotalVotes, StringFormat=Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²: {0}}"
                                                                                           FontSize="11"
                                                                                           Foreground="{DynamicResource TextSecondary}"
                                                                                           VerticalAlignment="Center"
                                                                                           IsVisible="{Binding CanVote, Converter={x:Static BoolConverters.Not}}"/>

																				<Button Grid.Column="1"
                                                                                        Content="Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð°Ñ‚ÑŒ"
                                                                                        Command="{Binding VoteCommand}"
                                                                                        IsVisible="{Binding CanVote}"
                                                                                        IsEnabled="{Binding CanVote}"
                                                                                        Background="{DynamicResource Accent}"
                                                                                        Foreground="White"
                                                                                        FontSize="12"
                                                                                        FontWeight="Medium"
                                                                                        Padding="16,8"
                                                                                        CornerRadius="8"/>
																			</Grid>
																		</StackPanel>
																	</Border>
																</DataTemplate>
															</ContentControl.ContentTemplate>
														</ContentControl>

														<!-- Ð’Ñ€ÐµÐ¼Ñ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¿ÑƒÐ·Ñ‹Ñ€Ñ -->
														<TextBlock Text="{Binding CreatedAt, StringFormat=HH:mm}"
                                                                   FontSize="10"
                                                                   Foreground="{DynamicResource TextSecondary}"
                                                                   Opacity="0.5"
                                                                   HorizontalAlignment="Right"
                                                                   Margin="0,2,0,0"
                                                                   IsVisible="{Binding ShowSenderName, Converter={x:Static BoolConverters.Not}}"/>
													</StackPanel>
												</Border>
											</StackPanel>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</Panel>

				<!-- ==================== ÐŸÐÐÐ•Ð›Ð¬ Ð’Ð’ÐžÐ”Ð Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð¯ ==================== -->
				<Border Grid.Row="3"
                        VerticalAlignment="Bottom"
                        Padding="16,0,16,20">
					<Grid RowDefinitions="Auto,Auto">

						<!-- ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ -->
						<ItemsControl Grid.Row="0"
                                      ItemsSource="{Binding LocalAttachments}"
                                      Margin="0,0,0,8"
                                      IsVisible="{Binding LocalAttachments.Count}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel Spacing="6"/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="vm:LocalFileAttachment">
									<Border Background="{DynamicResource PrimaryBG}"
                                            CornerRadius="10"
                                            Padding="10">
										<Grid ColumnDefinitions="Auto,*,Auto">
											<Border Grid.Column="0"
                                                    Width="44" Height="44"
                                                    CornerRadius="8"
                                                    ClipToBounds="True"
                                                    Background="{DynamicResource SecondaryBG}">
												<Panel>
													<TextBlock Text="ðŸ“Ž"
                                                               IsVisible="{Binding Thumbnail, Converter={x:Static ObjectConverters.IsNull}}"/>

													<Image Source="{Binding Thumbnail}"
                                                           IsVisible="{Binding Thumbnail, Converter={x:Static ObjectConverters.IsNotNull}}"/>
												</Panel>
											</Border>
											<StackPanel Grid.Column="1" Margin="12,0" VerticalAlignment="Center">
												<TextBlock Text="{Binding FileName}"
                                                           Foreground="{DynamicResource TextPrimary}"
                                                           FontWeight="Medium"
                                                           FontSize="13"
                                                           TextTrimming="CharacterEllipsis"/>
												<TextBlock Text="{Binding FileSizeFormatted}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource TextSecondary}"/>
											</StackPanel>
											<Button Grid.Column="2"
                                                    Classes="IconButton"
                                                    Width="32" Height="32"
                                                    CornerRadius="8"
                                                    ToolTip.Tip="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                                    Command="{Binding DataContext.RemoveAttachmentCommand, ElementName=Root}"
                                                    CommandParameter="{Binding}">
												<TextBlock Text="âœ•"
                                                           FontSize="14"
                                                           Foreground="{DynamicResource TextSecondary}"/>
											</Button>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>

						<!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° -->
						<Border Grid.Row="1"
                                Background="{DynamicResource PrimaryBG}"
                                CornerRadius="14"
                                BorderThickness="0">
							<Grid Margin="4">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="Auto"/>
									<ColumnDefinition/>
									<ColumnDefinition Width="Auto"/>
									<ColumnDefinition Width="Auto"/>
								</Grid.ColumnDefinitions>

								<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð° -->
								<Button Grid.Column="0"
                                        Classes="IconButton"
                                        ToolTip.Tip="ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»"
                                        Background="Transparent"
                                        Padding="0"
                                        Width="44"
                                        Height="44"
                                        CornerRadius="10"
                                        Command="{Binding AttachFileCommand}">
									<Path Data="{StaticResource AttachIcon}"
                                          Fill="{DynamicResource TextSecondary}"
                                          Width="20"
                                          Height="20"
                                          Stretch="Uniform"/>
								</Button>

								<!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
								<TextBox Grid.Column="1"
                                         Text="{Binding NewMessage, Mode=TwoWay}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Watermark="Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."
                                         Padding="8,12"
                                         FontSize="15"
                                         Foreground="{DynamicResource TextPrimary}"
                                         AcceptsReturn="True"
                                         FocusAdorner="{x:Null}"
                                         TextWrapping="Wrap"
                                         VerticalContentAlignment="Center"
                                         MinHeight="44"
                                         MaxHeight="400"
                                         CaretBrush="{DynamicResource TextPrimary}">
									<TextBox.Styles>
										<Style Selector="TextBox:focus-within /template/ Border">
											<Setter Property="Background" Value="Transparent"/>
											<Setter Property="BorderBrush" Value="Transparent"/>
											<Setter Property="BorderThickness" Value="0"/>
										</Style>
										<Style Selector="TextBox:pointerover /template/ Border">
											<Setter Property="Background" Value="Transparent"/>
											<Setter Property="BorderBrush" Value="Transparent"/>
											<Setter Property="BorderThickness" Value="0"/>
										</Style>
									</TextBox.Styles>
								</TextBox>

								<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐ¼Ð¾Ð´Ð·Ð¸ -->
								<Button Grid.Column="2"
                                        Classes="IconButton"
                                        ToolTip.Tip="Ð­Ð¼Ð¾Ð´Ð·Ð¸"
                                        Background="Transparent"
                                        Padding="0"
                                        Width="44"
                                        Height="44"
                                        CornerRadius="10"
                                        VerticalAlignment="Bottom">
									<Button.Flyout>
										<Flyout Placement="TopEdgeAlignedRight"
                                                ShowMode="TransientWithDismissOnPointerMoveAway">
											<StackPanel Spacing="8">
												<TextBlock Text="Ð­Ð¼Ð¾Ð´Ð·Ð¸"
                                                           FontWeight="SemiBold"
                                                           FontSize="14"
                                                           Foreground="{DynamicResource TextSecondary}"
                                                           Margin="4,0,0,4"/>
												<ItemsControl ItemsSource="{Binding PopularEmojis}">
													<ItemsControl.ItemsPanel>
														<ItemsPanelTemplate>
															<WrapPanel MaxWidth="320" Orientation="Horizontal"/>
														</ItemsPanelTemplate>
													</ItemsControl.ItemsPanel>
													<ItemsControl.ItemTemplate>
														<DataTemplate>
															<Button Classes="EmojiButton"
                                                                    Content="{Binding}"
                                                                    Command="{Binding DataContext.InsertEmojiCommand, ElementName=Root}"
                                                                    CommandParameter="{Binding}"/>
														</DataTemplate>
													</ItemsControl.ItemTemplate>
												</ItemsControl>
											</StackPanel>
										</Flyout>
									</Button.Flyout>
									<Path Data="{StaticResource EmojiIcon}"
                                          Fill="{DynamicResource TextSecondary}"
                                          Width="20"
                                          Height="20"
                                          Stretch="Uniform"/>
								</Button>

								<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ -->
								<Button Grid.Column="3"
                                        Margin="4"
                                        MinHeight="36"
                                        MinWidth="36"
                                        Width="36"
                                        Height="36"
                                        Background="{DynamicResource Accent}"
                                        Classes="IconButton"
                                        CornerRadius="10"
                                        Command="{Binding SendMessageCommand}"
                                        VerticalAlignment="Bottom"
                                        IsVisible="{Binding NewMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        IsEnabled="{Binding NewMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
									<Path Data="{StaticResource SendIcon}"
                                          Fill="White"
                                          Width="18" Height="18"
                                          Stretch="Uniform"/>
								</Button>
							</Grid>
						</Border>
					</Grid>
				</Border>
			</Grid>
		</Border>
	</Grid>
</UserControl>