<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:MessengerDesktop.ViewModels"
        xmlns:views="using:MessengerDesktop.Views"
        xmlns:chat="using:MessengerDesktop.Views.Chat"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        d:DesignWidth="800"
        d:DesignHeight="600"
        x:Class="MessengerDesktop.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        x:Name="MainWindowRoot"
        Icon="/Assets/avalonia-logo.ico"
        Title="Messenger"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="Default"
        ExtendClientAreaTitleBarHeightHint="35"
        Background="{DynamicResource PrimaryBG}"
        TransparencyLevelHint="AcrylicBlur"
        MinWidth="890"
        MinHeight="500">
	<Window.Styles>
		<!-- Overlay (затемнение фона) -->
		<Style Selector="Border.DialogOverlay">
			<Setter Property="Opacity" Value="0"/>
			<Setter Property="IsHitTestVisible" Value="False"/>
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Opacity" Duration="0:0:0.25" Easing="CubicEaseOut"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Border.DialogOverlay.Open">
			<Setter Property="Opacity" Value="1"/>
			<Setter Property="IsHitTestVisible" Value="True"/>
		</Style>

		<!-- Контейнер анимации (отдельный класс от визуального DialogContainer) -->
		<Style Selector="Border.DialogAnimWrapper">
			<Setter Property="Opacity" Value="0"/>
			<Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
			<Setter Property="RenderTransform">
				<TransformGroup>
					<ScaleTransform ScaleX="0.9" ScaleY="0.9"/>
					<TranslateTransform Y="30"/>
				</TransformGroup>
			</Setter>
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Opacity" Duration="0:0:0.2" Easing="CubicEaseOut"/>
					<TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut"/>
				</Transitions>
			</Setter>
		</Style>

		<Style Selector="Border.DialogAnimWrapper.Open">
			<Setter Property="Opacity" Value="1"/>
			<Setter Property="RenderTransform">
				<TransformGroup>
					<ScaleTransform ScaleX="1" ScaleY="1"/>
					<TranslateTransform Y="0"/>
				</TransformGroup>
			</Setter>
		</Style>

		<Style Selector="Border.DialogAnimWrapper.Closing">
			<Setter Property="Opacity" Value="0"/>
			<Setter Property="RenderTransform">
				<TransformGroup>
					<ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
					<TranslateTransform Y="20"/>
				</TransformGroup>
			</Setter>
		</Style>
	</Window.Styles>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition/>
			<ColumnDefinition MinWidth="200" MaxWidth="600"/>
			<ColumnDefinition/>
		</Grid.ColumnDefinitions>

		<!-- Title bar drag areas -->
		<Grid PointerPressed="OnTitleBarPointerPressed"
              IsHitTestVisible="True"
              Height="35"
              VerticalAlignment="Top"
              Background="Transparent"
              ZIndex="999"/>
		<Grid PointerPressed="OnTitleBarPointerPressed"
              Grid.Column="2"
              IsHitTestVisible="True"
              Height="35"
              VerticalAlignment="Top"
              Background="Transparent"
              ZIndex="999"/>

		<!-- Main content -->
		<ContentControl Content="{Binding CurrentViewModel}" Grid.ColumnSpan="3">
			<ContentControl.DataTemplates>
				<DataTemplate DataType="vm:LoginViewModel">
					<views:LoginView/>
				</DataTemplate>
				<DataTemplate DataType="vm:MainMenuViewModel">
					<views:MainMenuView/>
				</DataTemplate>
				<DataTemplate DataType="vm:ChatsViewModel">
					<views:ChatsView/>
				</DataTemplate>
				<DataTemplate DataType="vm:ChatViewModel">
					<chat:ChatView/>
				</DataTemplate>
				<DataTemplate DataType="vm:AdminViewModel">
					<views:AdminView/>
				</DataTemplate>
				<DataTemplate DataType="vm:ProfileViewModel">
					<views:ProfileView/>
				</DataTemplate>
				<DataTemplate DataType="vm:SettingsViewModel">
					<views:SettingsView/>
				</DataTemplate>
			</ContentControl.DataTemplates>
		</ContentControl>

		<!-- Dialog overlay (затемнение) -->
		<Border x:Name="DialogOverlay"
                Classes="DialogOverlay"
                Grid.ColumnSpan="3"
                Background="#80000000"
                ZIndex="10000"
                IsVisible="{Binding IsDialogVisible}"
                PointerPressed="OnDialogBackgroundPressed"/>

		<!-- Dialog animation wrapper (только для анимации, без визуального стиля) -->
		<Border x:Name="DialogAnimWrapper"
                Classes="DialogAnimWrapper"
                Grid.ColumnSpan="3"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                ZIndex="10001"
                IsVisible="{Binding IsDialogVisible}">

			<ContentControl Content="{Binding CurrentDialog}">
				<ContentControl.DataTemplates>
					<DataTemplate DataType="vm:UserProfileDialogViewModel">
						<views:UserProfileDialog/>
					</DataTemplate>
					<DataTemplate DataType="vm:PollDialogViewModel">
						<views:PollDialog/>
					</DataTemplate>
					<DataTemplate DataType="vm:ChatEditDialogViewModel">
						<views:ChatEditDialog/>
					</DataTemplate>
					<DataTemplate DataType="vm:UserEditDialogViewModel">
						<views:UserEditDialog/>
					</DataTemplate>
					<DataTemplate DataType="vm:DepartmentDialogViewModel">
						<views:DepartmentDialog/>
					</DataTemplate>
				</ContentControl.DataTemplates>
			</ContentControl>
		</Border>
	</Grid>
</Window>