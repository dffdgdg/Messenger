<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sys="using:System"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="MessengerDesktop.Views.MainMenuView"
             x:Name="Root"
             x:DataType="vm:MainMenuViewModel"
             xmlns:vm="using:MessengerDesktop.ViewModels"
             xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
             Background="{DynamicResource PrimaryBG}">

	<UserControl.Resources>
		<sys:Int32 x:Key="Index0">0</sys:Int32>
		<sys:Int32 x:Key="Index1">1</sys:Int32>
		<sys:Int32 x:Key="Index3">3</sys:Int32>
		<sys:Int32 x:Key="Index4">4</sys:Int32>
		<sys:Int32 x:Key="Index5">5</sys:Int32>
	</UserControl.Resources>

	<UserControl.Styles>
		<Style Selector="RadioButton.IconButton">
			<Setter Property="GroupName" Value="group"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{DynamicResource Icon}"/>
			<Setter Property="Width" Value="64"/>
			<Setter Property="Height" Value="64"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Transitions">
				<Setter.Value>
					<Transitions>
						<BrushTransition Property="Background" Duration="0:0:0.15"/>
						<BrushTransition Property="Foreground" Duration="0:0:0.15"/>
						<DoubleTransition Property="Opacity" Duration="0:0:0.1"/>
					</Transitions>
				</Setter.Value>
			</Setter>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="RadioButton">
						<Border Background="{TemplateBinding Background}"
                                CornerRadius="{TemplateBinding CornerRadius}"
                                Padding="8"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center">
							<StackPanel HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Width="64">
								<Path Data="{TemplateBinding Tag}"
                                      Width="22" Height="22"
                                      Stretch="Uniform"
                                      Fill="{TemplateBinding Foreground}"
                                      HorizontalAlignment="Center"/>
								<TextBlock Text="{TemplateBinding Content}"
                                           FontSize="11"
                                           FontWeight="SemiBold"
                                           Foreground="{TemplateBinding Foreground}"
                                           HorizontalAlignment="Center"
                                           Margin="0,6,0,0"
                                           Opacity="0.85"/>
							</StackPanel>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style Selector="RadioButton.IconButton:pointerover">
			<Setter Property="Background" Value="{DynamicResource BorderHover}"/>
			<Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
		</Style>

		<Style Selector="RadioButton.IconButton:checked">
			<Setter Property="Background" Value="{DynamicResource Accent}"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect BlurRadius="8"
                                      Color="#80000000"
                                      OffsetX="0" OffsetY="1"/>
				</Setter.Value>
			</Setter>
		</Style>

		<Style Selector="RadioButton.IconButton:pressed">
			<Setter Property="Background" Value="{DynamicResource AccentPressed}"/>
			<Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
		</Style>

		<Style Selector="RadioButton.IconButton:disabled">
			<Setter Property="Opacity" Value="0.5"/>
		</Style>

		<Style Selector="Button.ClearButton">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="6"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>
		<Style Selector="Button.ClearButton:pointerover">
			<Setter Property="Background" Value="{DynamicResource BorderHover}"/>
		</Style>
	</UserControl.Styles>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="73"/>
			<ColumnDefinition/>
		</Grid.ColumnDefinitions>

		<Border Background="{DynamicResource SecondaryBG}"
                Grid.Column="1"
                Margin="0,47,9,9"
				
                CornerRadius="8">
			<ContentControl Content="{Binding CurrentMenuViewModel}"/>
		</Border>

		<Grid Grid.Column="1"
              ColumnDefinitions="*,Auto,*"
              VerticalAlignment="Top"
              ZIndex="100">
			<Grid Grid.Column="0"/>
			<StackPanel Grid.Column="1"
                        Orientation="Vertical"
                        Width="400"
                        MinWidth="200"
                        MaxWidth="600"
                        HorizontalAlignment="Center">

				<Border Background="{DynamicResource SecondaryBG}"
                        CornerRadius="8"
                        BorderThickness="1"
                        BorderBrush="{DynamicResource BorderDefault}"
                        Margin="0,8,0,0"
                        Padding="4,0">
					<Grid ColumnDefinitions="Auto,*,Auto">

						<Path Grid.Column="0"
                              Data="{StaticResource SearchIcon}"
                              Width="16" Height="16"
                              Fill="{DynamicResource TextMuted}"
                              Stretch="Uniform"
                              Margin="8,0,6,0"
                              VerticalAlignment="Center"/>

						<TextBox Grid.Column="1"
                                 Text="{Binding SearchText, Mode=TwoWay}"
                                 Watermark="Поиск чатов и контактов..."
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Padding="4,8"
                                 FontSize="14"
                                 VerticalContentAlignment="Center"/>

						<Button Grid.Column="2"
                                Classes="ClearButton"
                                IsVisible="{Binding HasSearchText}"
                                Command="{Binding ClearSearchCommand}"
                                ToolTip.Tip="Очистить"
                                Margin="0,4,4,4">
							<Path Data="{StaticResource CloseIcon}"
                                  Fill="{DynamicResource TextMuted}"
                                  Width="10" Height="10"
                                  Stretch="Uniform"/>
						</Button>
					</Grid>
				</Border>

				<Border Background="{DynamicResource SecondaryBG}"
                        CornerRadius="0,0,8,8"
                        Margin="0,-1,0,0"
                        MaxHeight="350"
                        IsVisible="{Binding ShowResults}"
                        BorderThickness="1,0,1,1"
                        BorderBrush="{DynamicResource BorderDefault}">
					<ScrollViewer VerticalScrollBarVisibility="Auto">
						<ItemsControl ItemsSource="{Binding SearchResults}">
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="vm:SearchResultItem">
									<Button Background="Transparent"
                                            HorizontalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            BorderThickness="0"
                                            Padding="0"
                                            Cursor="Hand"
                                            Command="{Binding DataContext.SelectSearchResultCommand, ElementName=Root}"
                                            CommandParameter="{Binding}">
										<Grid ColumnDefinitions="Auto,*,Auto" Margin="12,8">
											<Border Grid.Column="0"
                                                    Width="36" Height="36"
                                                    CornerRadius="18"
                                                    ClipToBounds="True"
                                                    Background="{DynamicResource Accent}"
                                                    Margin="0,0,10,0">
												<Panel>
													<Path IsVisible="{Binding IsChat}"
                                                          Data="{StaticResource ChatsIcon}"
                                                          Fill="White"
                                                          Width="16" Height="16"
                                                          Stretch="Uniform"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
													<Path IsVisible="{Binding IsContact}"
                                                          Data="{StaticResource PersonIcon}"
                                                          Fill="White"
                                                          Width="16" Height="16"
                                                          Stretch="Uniform"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
													<Image Stretch="UniformToFill"
                                                           IsVisible="{Binding HasAvatar}"
                                                           asyncImageLoader:ImageLoader.Source="{Binding AvatarUrl}"/>
												</Panel>
											</Border>

											<StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
												<TextBlock Text="{Binding Title}"
                                                           FontWeight="SemiBold"
                                                           FontSize="14"
                                                           Foreground="{DynamicResource TextPrimary}"
                                                           TextTrimming="CharacterEllipsis"/>
												<TextBlock Text="{Binding Subtitle}"
                                                           FontSize="12"
                                                           Foreground="{DynamicResource TextMuted}"
                                                           TextTrimming="CharacterEllipsis"
                                                           IsVisible="{Binding Subtitle, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
											</StackPanel>

											<Border Grid.Column="2"
                                                    VerticalAlignment="Center"
                                                    Padding="6,3"
                                                    CornerRadius="4"
                                                    Background="{DynamicResource ThirdBG}"
                                                    Margin="8,0,0,0">
												<TextBlock Text="{Binding TypeText}"
                                                           FontSize="10"
                                                           Foreground="{DynamicResource TextMuted}"/>
											</Border>
										</Grid>
									</Button>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</Border>

				<Border Background="{DynamicResource SecondaryBG}"
                        CornerRadius="0,0,8,8"
                        BorderThickness="1,0,1,1"
                        BorderBrush="{DynamicResource BorderDefault}"
                        Margin="0,-1,0,0"
                        IsVisible="{Binding ShowNoResults}"
                        Padding="16,12">
					<StackPanel HorizontalAlignment="Center" Spacing="6">
						<Path Data="{StaticResource SearchIcon}"
                              Fill="{DynamicResource TextMuted}"
                              Width="24" Height="24"
                              Stretch="Uniform"
                              HorizontalAlignment="Center"
                              Opacity="0.5"/>
						<TextBlock Text="Ничего не найдено"
                                   FontSize="13"
                                   Foreground="{DynamicResource TextMuted}"
                                   HorizontalAlignment="Center"/>
					</StackPanel>
				</Border>
			</StackPanel>
			<Grid Grid.Column="2"/>
		</Grid>

		<Border Grid.Column="1"
                Background="Transparent"
                IsVisible="{Binding ShowResults}"
                Margin="0,47,9,9"
                />

		<StackPanel Width="67" Orientation="Vertical" Spacing="4">
			<StackPanel Orientation="Horizontal" Margin="10,10,10,5">
				<TextBlock VerticalAlignment="Center"
                           FontWeight="Bold"
                           FontSize="14"
                           Margin="0,5,5,5"
                           HorizontalAlignment="Left">ВнутрьСвязь</TextBlock>
			</StackPanel>
			<RadioButton Classes="IconButton" Height="58"
                         Tag="{DynamicResource ChatsIcon}"
                         Content="Чаты"
                         IsChecked="True"
                         Command="{Binding SetItemCommand}"
                         CommandParameter="{StaticResource Index1}"/>
			<RadioButton Classes="IconButton" Height="58"
                         Tag="{DynamicResource ContactsIcon}"
                         Content="Контакты"
                         Command="{Binding SetItemCommand}"
                         CommandParameter="{StaticResource Index5}"/>
		</StackPanel>

		<StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,10" Spacing="4">
			<RadioButton Classes="IconButton" Height="58"
                         Tag="{DynamicResource ProfileIcon}"
                         Content="Профиль"
                         Command="{Binding SetItemCommand}"
                         CommandParameter="{StaticResource Index3}"/>
			<RadioButton Classes="IconButton"
                         Height="58" Width="64"
                         Command="{Binding SetItemCommand}"
                         Tag="{DynamicResource SettingsIcon}"
                         Content="Настройки"
                         CommandParameter="{StaticResource Index0}"/>
			<RadioButton Classes="IconButton"
                         Height="58" Width="64"
                         Command="{Binding SetItemCommand}"
                         CommandParameter="{StaticResource Index4}"
                         Tag="{DynamicResource SettingsIcon}"
                         Content="Admin"/>
		</StackPanel>
	</Grid>
</UserControl>