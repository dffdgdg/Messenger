<UserControl x:Name="Root"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="1200"
             x:Class="MessengerDesktop.Views.ChatsView"
             Background="{DynamicResource PrimaryBG}"
             x:DataType="vm:ChatsViewModel"
             xmlns:vm="using:MessengerDesktop.ViewModels"
             xmlns:conv="using:MessengerDesktop.Converters"
             xmlns:views="using:MessengerDesktop.Views"
             xmlns:shared="using:MessengerShared.DTO">

	<Grid x:Name="MainGrid">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="280" MinWidth="220" MaxWidth="400"/>
			<ColumnDefinition Width="Auto"/>
			<ColumnDefinition MinWidth="400"/>
			<ColumnDefinition Width="Auto"/>
		</Grid.ColumnDefinitions>

		<Grid x:Name="ChatListPanel" Grid.Column="0">
			<DockPanel>

				<Border DockPanel.Dock="Top"
                        Padding="16,8"
						BorderThickness="0,0,0,1"
						BorderBrush="{DynamicResource BorderDefault}"
						Margin="0,1,0,0"
                        Background="{DynamicResource PrimaryBG}">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="Чаты"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>

						<Button Grid.Column="1"
                                Classes="IconButton"
								Command="{Binding CreateGroupCommand}"
                                ToolTip.Tip="Новый чат">
							<PathIcon Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                      Width="18" Height="18"
                                      Foreground="{DynamicResource Icon}"/>
						</Button>
					</Grid>
				</Border>

				<!--Чат-->
				<Border DockPanel.Dock="Top"
                        Classes="SearchContainer"
                        Margin="12,8,12,12"
                        Height="36"
						>
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<PathIcon Grid.Column="0"
                                  Data="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource TextMuted}"
                                  Margin="10,0,8,0"/>

						<TextBox Grid.Column="1"
                                 Watermark="Поиск..."
                                 Background="Transparent"
                                 BorderThickness="0"
								 VerticalContentAlignment="Center"
                                 VerticalAlignment="Center"
                                 Padding="0,0,10,0"/>
					</Grid>
				</Border>

				<ListBox ItemsSource="{Binding Chats}"
                         SelectedItem="{Binding SelectedChat, Mode=TwoWay}"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="8,0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">

					<ListBox.Styles>
						<Style Selector="ListBoxItem">
							<Setter Property="Background" Value="Transparent"/>
							<Setter Property="CornerRadius" Value="8"/>
							<Setter Property="Padding" Value="8"/>
							<Setter Property="Margin" Value="0,1"/>
							<Setter Property="Cursor" Value="Hand"/>
							<Setter Property="Transitions">
								<Transitions>
									<BrushTransition Property="Background" Duration="0:0:0.15"/>
								</Transitions>
							</Setter>
						</Style>
						<Style Selector="ListBoxItem:pointerover">
							<Setter Property="Background" Value="{DynamicResource BorderHover}"/>
						</Style>
						<Style Selector="ListBoxItem:selected">
							<Setter Property="Background" Value="{DynamicResource Accent}"/>
						</Style>
						<Style Selector="ListBoxItem:selected:pointerover">
							<Setter Property="Background" Value="{DynamicResource AccentHover}"/>
						</Style>
					</ListBox.Styles>

					<ListBox.ItemTemplate>
						<DataTemplate x:DataType="shared:ChatDTO">
							<Grid Height="52" ColumnDefinitions="Auto,*,Auto">

								<Border Grid.Column="0"
                                        Classes="Avatar Medium"
                                        VerticalAlignment="Center">
									<Panel>
										<Ellipse Width="44" Height="44"
                                                 Fill="{DynamicResource AvatarPlaceholderBG}"
                                                 IsVisible="{Binding Avatar, Converter={x:Static ObjectConverters.IsNull}}"/>
										<Ellipse Width="44" Height="44"
                                                 IsVisible="{Binding Avatar, Converter={x:Static ObjectConverters.IsNotNull}}">
											<Ellipse.Fill>
												<Binding Path="Avatar"/>
											</Ellipse.Fill>
										</Ellipse>

										<TextBlock 
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimary}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   IsVisible="{Binding Avatar, Converter={x:Static ObjectConverters.IsNull}}"/>
									</Panel>
								</Border>

								<StackPanel Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Margin="12,0,8,0">

									<TextBlock Text="{Binding Name}"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               TextTrimming="CharacterEllipsis"
                                               MaxLines="1"/>

									<TextBlock Text="..."
                                               Foreground="{DynamicResource TextSecondary}"
                                               FontSize="13"
                                               TextTrimming="CharacterEllipsis"
                                               MaxLines="1"
                                               Margin="0,2,0,0"/>
								</StackPanel>

								<StackPanel Grid.Column="2"
                                            VerticalAlignment="Top"
                                            HorizontalAlignment="Right"
                                            Margin="0,2,0,0">

									<TextBlock Text="{Binding LastMessageDate, Converter={conv:Converter Name=MessageTime}}"
                                               Foreground="{DynamicResource TextMuted}"
                                               FontSize="11"
                                               HorizontalAlignment="Right"/>

									<Border Background="{DynamicResource Accent}"
                                            CornerRadius="10"
                                            MinWidth="20"
                                            Height="20"
                                            Padding="6,0"
                                            Margin="0,4,0,0"
                                            HorizontalAlignment="Right"
                                            IsVisible="{Binding Id, Converter={x:Static ObjectConverters.IsNotNull}}">
										<TextBlock Text="1"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimary}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
									</Border>
								</StackPanel>
							</Grid>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</DockPanel>
		</Grid>

		<GridSplitter x:Name="GridSplitter"
                      Grid.Column="1"
                      Width="4"
                      ResizeDirection="Columns"
                      Background="Transparent"
                      ResizeBehavior="PreviousAndNext">
			<GridSplitter.Styles>
				<Style Selector="GridSplitter:pointerover">
					<Setter Property="Background" Value="{DynamicResource BorderHover}"/>
				</Style>
			</GridSplitter.Styles>
		</GridSplitter>

		<Border Grid.Column="2"
                CornerRadius="16"
                Background="{DynamicResource SecondaryBG}"
                BorderBrush="{DynamicResource BorderDefault}"
                BorderThickness="1"
                ClipToBounds="True">

			<Panel>
				<ContentControl Content="{Binding CurrentChatViewModel}"/>

				<StackPanel VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            IsVisible="{Binding SelectedChat, Converter={x:Static ObjectConverters.IsNull}}">

					<PathIcon Data="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"
                              Width="64" Height="64"
                              Foreground="{DynamicResource TextMuted}"
                              Opacity="0.5"/>

					<TextBlock Text="Выберите чат"
                               FontSize="18"
                               FontWeight="Medium"
                               Foreground="{DynamicResource TextMuted}"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0"/>

					<TextBlock Text="или начните новый диалог"
                               FontSize="14"
                               Foreground="{DynamicResource TextMuted}"
                               Opacity="0.7"
                               HorizontalAlignment="Center"
                               Margin="0,4,0,0"/>
				</StackPanel>
			</Panel>
		</Border>

		<views:ChatInfoPanel x:Name="InfoPanel"
                             Grid.Column="3"
                             DataContext="{Binding CurrentChatViewModel}"/>
	</Grid>
</UserControl>