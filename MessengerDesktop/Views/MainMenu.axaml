<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="MessengerDesktop.Views.MainMenuView"
             x:Name="Root"
             x:DataType="vm:MainMenuViewModel"
             xmlns:vm="using:MessengerDesktop.ViewModels"
             xmlns:shared="using:MessengerShared.DTO"
             xmlns:conv="using:MessengerDesktop.Converters"
             xmlns:views="using:MessengerDesktop.Views"
             Background="{DynamicResource PrimaryBG}">
	<UserControl.Styles>
    <!-- Базовый стиль -->
    <Style Selector="RadioButton.IconButton">
		<Setter Property="GroupName" Value="group"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Foreground" Value="{DynamicResource Icon}"/>
        <Setter Property="Width" Value="64"/>
        <Setter Property="Height" Value="64"/>
        <Setter Property="CornerRadius" Value="8"/>
        <Setter Property="Cursor" Value="Hand"/>

        <Setter Property="Transitions">
            <Setter.Value>
                <Transitions>
                    <BrushTransition Property="Background" Duration="0:0:0.15"/>
                    <BrushTransition Property="Foreground" Duration="0:0:0.15"/>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.1"/>
                </Transitions>
            </Setter.Value>
        </Setter>

		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="RadioButton">
					<Border
						Background="{TemplateBinding Background}"
						CornerRadius="{TemplateBinding CornerRadius}"
						Padding="8"
						HorizontalAlignment="Stretch"
						VerticalAlignment="Center">
						<StackPanel HorizontalAlignment="Center"
									VerticalAlignment="Center"
									Width="64">
							<!-- Иконка -->
							<Path Data="{TemplateBinding Tag}"
								  Width="22" Height="22"
								  Stretch="Uniform"
								  Fill="{TemplateBinding Foreground}"
								  HorizontalAlignment="Center"/>
							<!-- Подпись -->
							<TextBlock Text="{TemplateBinding Content}"
									   FontSize="11"
									   FontWeight="SemiBold"
									   Foreground="{TemplateBinding Foreground}"
									   HorizontalAlignment="Center"
									   Margin="0,6,0,0"
									   Opacity="0.85"/>
						</StackPanel>
					</Border>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>

    <!-- Hover -->
    <Style Selector="RadioButton.IconButton:pointerover">
        <Setter Property="Background" Value="{DynamicResource BorderHover}"/>
        <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
    </Style>

    <!-- Checked -->
    <Style Selector="RadioButton.IconButton:checked">
        <Setter Property="Background" Value="{DynamicResource Accent}"/>
        <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
        <Setter Property="Effect">
            <Setter.Value>
                <DropShadowEffect BlurRadius="8"
                                  Color="#80000000"
                                  OffsetX="0" OffsetY="1"/>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Pressed -->
    <Style Selector="RadioButton.IconButton:pressed">
        <Setter Property="Background" Value="{DynamicResource AccentPressed}"/>
        <Setter Property="Foreground" Value="{DynamicResource TextPrimary}"/>
    </Style>

    <!-- Disabled -->
    <Style Selector="RadioButton.IconButton:disabled">
        <Setter Property="Opacity" Value="0.5"/>
    </Style>
</UserControl.Styles>


	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="73"/>
			<ColumnDefinition/>
		</Grid.ColumnDefinitions>

		<Border Background="{DynamicResource SecondaryBG}"
                Grid.Column="1"
                Margin="0,47,9,9"
                CornerRadius="6">
			<ContentControl Content="{Binding CurrentMenuViewModel}"/>
		</Border>

		<!-- Поиск -->
        <Grid Grid.Column="1" 
              ColumnDefinitions="*,Auto,*"
              VerticalAlignment="Top">
            <Grid Grid.Column="0"/>
            <StackPanel Grid.Column="1" 
                      Orientation="Vertical" 
                      Width="400" 
                      MinWidth="200" 
                      MaxWidth="600" 
                      HorizontalAlignment="Center" 
                      ZIndex="100">
                <TextBox x:Name="SearchBox"
						 Background="{DynamicResource SecondaryBG}"
                         Watermark="Ищите чаты, контакты"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Center"
                         Margin="0,6,0,0"
                         Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <Border Background="{DynamicResource SecondaryBG}"
                         CornerRadius="6"
                         Margin="0,2,0,0"
                         IsVisible="{Binding HasSearchResults}"
                         Effect="drop-shadow(0 2 8 #80000000)">
                    <ItemsControl ItemsSource="{Binding FilteredContacts}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="shared:UserDTO">
                                <Button Background="Transparent" 
                                        HorizontalAlignment="Stretch" 
                                        BorderThickness="0" 
                                        Padding="0" 
                                        Command="{Binding DataContext.OpenOrCreateChatCommand, ElementName=Root}" 
                                        CommandParameter="{Binding .}">
                                    <StackPanel Orientation="Horizontal" 
                                              Margin="12,6" 
                                              Cursor="Hand">
                                        <Ellipse Width="32" Height="32" 
                                                Fill="{DynamicResource Accent}"/>
                                        <TextBlock Foreground="White" 
                                                 FontWeight="Bold" 
                                                 FontSize="14" 
                                                 Margin="10,0,0,0"
                                                 Text="{Binding ., Converter={conv:Converter Name=DisplayOrUsername}}"/>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>
            </StackPanel>
            <Grid Grid.Column="2"/>
        </Grid>

		<!-- Боковое меню -->
		<StackPanel Width="67" Orientation="Vertical">
			<StackPanel Orientation="Horizontal" Margin="10,10,10,5">
				<TextBlock VerticalAlignment="Center"
                          FontWeight="Bold"
                          FontSize="14"
                          Margin="0,5,5,5"
                          HorizontalAlignment="Left">ВнутрьСвязь</TextBlock>
			</StackPanel>
			<RadioButton Classes="IconButton" Height="58"
                         Tag="{DynamicResource ChatsIcon}"
                         Content="Чаты"
                         Command="{Binding SetItem}"
                         CommandParameter="1"/>
			<RadioButton Classes="IconButton" Height="58"
                         Tag="{DynamicResource ContactsIcon}"
                         Content="Контакты"
                         Command="{Binding SetItem}"
                         CommandParameter="5"/>
		</StackPanel>

		<!-- Нижние кнопки меню -->
		<StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Center">
			<RadioButton Classes="IconButton" Height="58"
                         Tag="{DynamicResource ProfileIcon}"
                         Content="Профиль"
                         Command="{Binding SetItem}"
                         CommandParameter="3"/>
			<RadioButton Classes="IconButton"
                         Height="58" Width="64"
                         Command="{Binding SetItem}"
                         Tag="{DynamicResource SettingsIcon}"
                         Content="Настройки"
                         CommandParameter="0"/>
			<RadioButton Classes="IconButton"
                         Height="58" Width="64"
                         Command="{Binding SetItem}"
						 CommandParameter="4"
                         Tag="{DynamicResource SettingsIcon}"
                         Content="Admin"/>
		</StackPanel>

		<!-- UserProfileDialog -->
		<Grid Name="ProfileDialogOverlay"
              IsVisible="{Binding UserProfileDialog, Converter={conv:Converter Name=NullToVisibility}}"
              Grid.ColumnSpan="2"
              Background="#80000000"
              Opacity="0"
              ZIndex="1000">

			<Grid.Styles>
				<Style Selector="Grid#ProfileDialogOverlay">
					<Style.Animations>
						<Animation Duration="0:0:0.3">
							<KeyFrame Cue="0%">
								<Setter Property="Opacity" Value="0"/>
							</KeyFrame>
							<KeyFrame Cue="100%">
								<Setter Property="Opacity" Value="1"/>
							</KeyFrame>
						</Animation>
					</Style.Animations>
				</Style>

				<Style Selector="views|UserProfileDialog">
					<Setter Property="RenderTransformOrigin" Value="50%,50%"/>
					<Style.Animations>
						<Animation Duration="0:0:0.4" Easing="CircularEaseOut">
							<KeyFrame Cue="0%">
								<Setter Property="Opacity" Value="0"/>
								<Setter Property="ScaleTransform.ScaleX" Value="0.5"/>
								<Setter Property="ScaleTransform.ScaleY" Value="0.5"/>
								<Setter Property="TranslateTransform.Y" Value="50"/>
							</KeyFrame>
							<KeyFrame Cue="100%">
								<Setter Property="Opacity" Value="1"/>
								<Setter Property="ScaleTransform.ScaleX" Value="1"/>
								<Setter Property="ScaleTransform.ScaleY" Value="1"/>
								<Setter Property="TranslateTransform.Y" Value="0"/>
							</KeyFrame>
						</Animation>
					</Style.Animations>
				</Style>
			</Grid.Styles>

			<Rectangle Fill="#80000000"
                       PointerPressed="OnProfileBackgroundPressed"/>

			<views:UserProfileDialog DataContext="{Binding UserProfileDialog}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
				<views:UserProfileDialog.RenderTransform>
					<TransformGroup>
						<ScaleTransform ScaleX="0.5" ScaleY="0.5"/>
						<TranslateTransform X="0" Y="50"/>
					</TransformGroup>
				</views:UserProfileDialog.RenderTransform>
				<views:UserProfileDialog.Opacity>0</views:UserProfileDialog.Opacity>
			</views:UserProfileDialog>
		</Grid>

		<!-- Poll Dialog overlay -->
		<Grid Name="PollDialogOverlay"
              IsVisible="{Binding IsPollDialogOpen}"
              Grid.ColumnSpan="2"
              Background="#80000000"
              Opacity="0"
              ZIndex="1000">

			<Grid.Styles>
				<Style Selector="Grid#PollDialogOverlay">
					<Style.Animations>
						<Animation Duration="0:0:0.3">
							<KeyFrame Cue="0%">
								<Setter Property="Opacity" Value="0"/>
							</KeyFrame>
							<KeyFrame Cue="100%">
								<Setter Property="Opacity" Value="1"/>
							</KeyFrame>
						</Animation>
					</Style.Animations>
				</Style>

				<Style Selector="views|PollDialog">
					<Setter Property="RenderTransformOrigin" Value="50%,50%"/>
					<Style.Animations>
						<Animation Duration="0:0:0.4" Easing="CircularEaseOut">
							<KeyFrame Cue="0%">
								<Setter Property="Opacity" Value="0"/>
								<Setter Property="ScaleTransform.ScaleX" Value="0.5"/>
								<Setter Property="ScaleTransform.ScaleY" Value="0.5"/>
								<Setter Property="TranslateTransform.Y" Value="50"/>
							</KeyFrame>
							<KeyFrame Cue="100%">
								<Setter Property="Opacity" Value="1"/>
								<Setter Property="ScaleTransform.ScaleX" Value="1"/>
								<Setter Property="ScaleTransform.ScaleY" Value="1"/>
								<Setter Property="TranslateTransform.Y" Value="0"/>
							</KeyFrame>
						</Animation>
					</Style.Animations>
				</Style>
			</Grid.Styles>

			<Rectangle Fill="#80000000"
                       PointerPressed="OnPollBackgroundPressed"/>

			<views:PollDialog DataContext="{Binding PollDialogViewModel}"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"
                             Width="400">
				<views:PollDialog.RenderTransform>
					<TransformGroup>
						<ScaleTransform ScaleX="0.5" ScaleY="0.5"/>
						<TranslateTransform X="0" Y="50"/>
					</TransformGroup>
				</views:PollDialog.RenderTransform>
				<views:PollDialog.Opacity>0</views:PollDialog.Opacity>
			</views:PollDialog>
		</Grid>
	</Grid>
</UserControl>