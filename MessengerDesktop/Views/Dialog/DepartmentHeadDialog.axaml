<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:MessengerDesktop.ViewModels"
             xmlns:shared="using:MessengerShared.DTO"
             xmlns:controls="using:MessengerDesktop.Controls"
             x:Class="MessengerDesktop.Views.DepartmentHeadDialog"
             x:DataType="vm:DepartmentHeadDialogViewModel">

	<Border Classes="DialogContainer" Width="440">
		<StackPanel Spacing="20">

			<!-- Заголовок с иконкой -->
			<Grid ColumnDefinitions="Auto,*,Auto">
				<Border Grid.Column="0"
                        Background="{DynamicResource AccentBrush}"
                        Width="44" Height="44"
                        CornerRadius="12"
                        Margin="0,0,14,0">
					<PathIcon Data="{StaticResource OrganizationIcon}"
                              Width="22" Height="22"
                              Foreground="{DynamicResource TextOnAccent}"/>
				</Border>

				<StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
					<TextBlock Text="{Binding Title}"
                               FontSize="18"
                               FontWeight="Bold"/>
					<TextBlock Text="Отдел"
                               FontSize="12"
                               Foreground="{DynamicResource TextSecondary}"/>
				</StackPanel>

				<Button Grid.Column="2"
                        Classes="IconButton"
                        Command="{Binding CancelCommand}"
                        ToolTip.Tip="Закрыть">
					<PathIcon Data="{StaticResource DismissIcon}"
                              Width="14" Height="14"
                              Foreground="{DynamicResource TextSecondary}"/>
				</Button>
			</Grid>

			<!-- Разделитель -->
			<Border Height="1" Background="{DynamicResource BorderDefault}" Margin="-24,0"/>

			<!-- Название отдела -->
			<StackPanel Spacing="6">
				<TextBlock Text="Название отдела"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextSecondary}"/>
				<TextBox Text="{Binding Name}"
                         Classes="DialogInput"
                         Watermark="Введите название отдела...">
					<TextBox.InnerLeftContent>
						<PathIcon Data="{StaticResource folder_regular}"
                                  Width="16" Height="16"
                                  Margin="12,0,8,0"
                                  Foreground="{DynamicResource TextSecondary}"/>
					</TextBox.InnerLeftContent>
				</TextBox>
			</StackPanel>

			<!-- Родительский отдел -->
			<StackPanel Spacing="6">
				<TextBlock Text="Родительский отдел"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextSecondary}"/>
				<ComboBox ItemsSource="{Binding AvailableParents}"
                          SelectedItem="{Binding SelectedParent}"
                          Classes="DialogCombo"
                          PlaceholderText="Выбрать родительский отдел"
                          HorizontalAlignment="Stretch">
					<ComboBox.ItemTemplate>
						<DataTemplate x:DataType="shared:DepartmentDTO">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<PathIcon Data="{StaticResource OrganizationIcon}"
                                          Width="14" Height="14"
                                          Foreground="{DynamicResource TextSecondary}"/>
								<TextBlock Text="{Binding Name}"/>
							</StackPanel>
						</DataTemplate>
					</ComboBox.ItemTemplate>
				</ComboBox>
			</StackPanel>

			<!-- Руководитель отдела -->
			<StackPanel Spacing="6">
				<TextBlock Text="Руководитель отдела"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextSecondary}"/>

				<Border Background="{DynamicResource SurfaceVariant}"
                        CornerRadius="10"
                        Padding="12"
                        BorderThickness="1"
                        BorderBrush="{DynamicResource BorderDefault}">
					<Grid ColumnDefinitions="Auto,*,Auto,Auto">

						<!-- Аватар руководителя -->
						<controls:AvatarControl Grid.Column="0"
                                                Classes="Small"
                                                Source="{Binding SelectedHead.Avatar}"
                                                DisplayName="{Binding SelectedHead.DisplayName}"
                                                IsVisible="{Binding HasHead}"
                                                Margin="0,0,12,0"/>

						<!-- Иконка если не выбран -->
						<Border Grid.Column="0"
                                Width="36" Height="36"
                                CornerRadius="18"
                                Background="{DynamicResource SurfaceBrush}"
                                IsVisible="{Binding !HasHead}"
                                Margin="0,0,12,0">
							<PathIcon Data="{StaticResource PersonIcon}"
                                      Width="18" Height="18"
                                      Foreground="{DynamicResource TextTertiary}"/>
						</Border>

						<!-- Информация -->
						<StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
							<TextBlock Text="{Binding HeadDisplayText}"
                                       FontSize="14"
                                       TextTrimming="CharacterEllipsis"/>
							<TextBlock Text="Руководитель отдела"
                                       FontSize="11"
                                       Foreground="{DynamicResource TextTertiary}"
                                       IsVisible="{Binding HasHead}"/>
						</StackPanel>

						<!-- Кнопка очистить -->
						<Button Grid.Column="2"
                                Classes="IconButton Small"
                                Command="{Binding ClearHeadCommand}"
                                IsVisible="{Binding HasHead}"
                                ToolTip.Tip="Убрать руководителя"
                                Margin="8,0,4,0">
							<PathIcon Data="{StaticResource dismiss_circle_regular}"
                                      Width="16" Height="16"
                                      Foreground="{DynamicResource DangerBrush}"/>
						</Button>

						<!-- Кнопка выбрать -->
						<Button Grid.Column="3"
                                Classes="IconButton"
                                Command="{Binding SelectHeadCommand}"
                                ToolTip.Tip="Выбрать руководителя">
							<PathIcon Data="{StaticResource person_AddIcon}"
                                      Width="18" Height="18"
                                      Foreground="{DynamicResource AccentBrush}"/>
						</Button>
					</Grid>
				</Border>
			</StackPanel>

			<!-- Информация об отделе (только для существующих) -->
			<Border Background="{DynamicResource InfoBg}"
                    CornerRadius="8"
                    Padding="12"
                    IsVisible="{Binding !IsNewDepartment}">
				<StackPanel Spacing="8">
					<!-- Количество сотрудников -->
					<Grid ColumnDefinitions="Auto,*,Auto">
						<PathIcon Grid.Column="0"
                                  Data="{StaticResource PersonIcon}"
                                  Width="14" Height="14"
                                  Foreground="{DynamicResource TextSecondary}"
                                  Margin="0,0,8,0"/>
						<TextBlock Grid.Column="1"
                                   Text="Сотрудников в отделе"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondary}"/>
						<TextBlock Grid.Column="2"
                                   Text="{Binding UserCount}"
                                   FontSize="12"
                                   FontWeight="SemiBold"/>
					</Grid>

					<!-- Предупреждение о дочерних отделах -->
					<Grid ColumnDefinitions="Auto,*" IsVisible="{Binding HasChildren}">
						<PathIcon Grid.Column="0"
                                  Data="{StaticResource WarningIcon}"
                                  Width="14" Height="14"
                                  Foreground="{DynamicResource WarningBrush}"
                                  Margin="0,0,8,0"/>
						<TextBlock Grid.Column="1"
                                   Text="Имеет дочерние отделы"
                                   FontSize="12"
                                   Foreground="{DynamicResource WarningBrush}"/>
					</Grid>
				</StackPanel>
			</Border>

			<!-- Сообщение об ошибке -->
			<Border Background="{DynamicResource DangerBg}"
                    CornerRadius="8"
                    Padding="12"
                    IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<Grid ColumnDefinitions="Auto,*">
					<PathIcon Grid.Column="0"
                              Data="{StaticResource error_circle_regular}"
                              Width="16" Height="16"
                              Foreground="{DynamicResource DangerBrush}"
                              Margin="0,0,10,0"/>
					<TextBlock Grid.Column="1"
                               Text="{Binding ErrorMessage}"
                               Foreground="{DynamicResource DangerBrush}"
                               FontSize="12"
                               TextWrapping="Wrap"/>
				</Grid>
			</Border>

			<!-- Сообщение об успехе -->
			<Border Background="{DynamicResource SuccessBg}"
                    CornerRadius="8"
                    Padding="12"
                    IsVisible="{Binding SuccessMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
				<Grid ColumnDefinitions="Auto,*">
					<PathIcon Grid.Column="0"
                              Data="{StaticResource checkmark_circle_regular}"
                              Width="16" Height="16"
                              Foreground="{DynamicResource SuccessBrush}"
                              Margin="0,0,10,0"/>
					<TextBlock Grid.Column="1"
                               Text="{Binding SuccessMessage}"
                               Foreground="{DynamicResource SuccessBrush}"
                               FontSize="12"
                               TextWrapping="Wrap"/>
				</Grid>
			</Border>

			<!-- Разделитель -->
			<Border Height="1" Background="{DynamicResource BorderDefault}" Margin="-24,0"/>

			<!-- Кнопки действий -->
			<Grid ColumnDefinitions="Auto,*,Auto,Auto">

				<!-- Кнопка удаления (только для существующих отделов) -->
				<Button Grid.Column="0"
                        Classes="DialogDanger"
                        Command="{Binding DeleteCommand}"
                        IsVisible="{Binding !IsNewDepartment}"
                        IsEnabled="{Binding CanDelete}"
                        ToolTip.Tip="{Binding DeleteTooltip}">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<PathIcon Data="{StaticResource delete_regular}"
                                  Width="14" Height="14"/>
						<TextBlock Text="Удалить"/>
					</StackPanel>
				</Button>

				<!-- Спейсер -->
				<Border Grid.Column="1"/>

				<!-- Отмена -->
				<Button Grid.Column="2"
                        Content="Отмена"
                        Classes="DialogOutline"
                        Command="{Binding CancelCommand}"
                        Margin="0,0,10,0"/>

				<!-- Сохранить -->
				<Button Grid.Column="3"
                        Classes="DialogAccent"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding CanSave}">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<PathIcon Data="{StaticResource CheckmarkIcon}"
                                  Width="14" Height="14"
                                  Foreground="{DynamicResource TextOnAccent}"/>
						<TextBlock Text="Сохранить"
                                   Foreground="{DynamicResource TextOnAccent}"/>
					</StackPanel>
				</Button>
			</Grid>
		</StackPanel>
	</Border>
</UserControl>