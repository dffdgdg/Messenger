<UserControl x:Name="Root"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="1200"
             x:Class="MessengerDesktop.Views.ChatsView"
             Background="{DynamicResource PrimaryBG}"
             x:DataType="vm:ChatsViewModel"
             xmlns:vm="using:MessengerDesktop.ViewModels"
             xmlns:chat="using:MessengerDesktop.ViewModels.Chat"
             xmlns:conv="using:MessengerDesktop.Converters"
             xmlns:views="using:MessengerDesktop.Views"
             xmlns:controls="using:MessengerDesktop.Controls"
             xmlns:shared="using:MessengerShared.DTO"
             xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia">

	<UserControl.Resources>
		<!-- Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð° Ñ‡Ð°Ñ‚Ð° Ð´Ð»Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð¿Ð¾Ð¸ÑÐºÐ° (ChatDTO) -->
		<DataTemplate x:Key="ChatSearchResultTemplate" x:DataType="shared:ChatDTO">
			<Grid Height="52" ColumnDefinitions="Auto,*,50">
				<controls:AvatarControl Grid.Column="0"
                                        Classes="Medium"
                                        Source="{Binding Avatar}"
                                        DisplayName="{Binding Name}"
                                        FallbackIcon="{StaticResource GroupIcon}"
                                        ShowOnlineIndicator="False"
                                        VerticalAlignment="Center"/>

				<StackPanel Grid.Column="1"
                            VerticalAlignment="Center"
                            Margin="12,0,8,0">
					<TextBlock Text="{Binding Name}"
                               FontWeight="SemiBold"
                               FontSize="14"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1"/>

					<TextBlock Foreground="{DynamicResource TextSecondary}"
                               FontSize="13"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1"
                               Margin="0,2,0,0"
                               IsVisible="{Binding LastMessagePreview, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
						<Run Text="{Binding LastMessageSenderName}"/>
						<Run Text=": "/>
						<Run Text="{Binding LastMessagePreview}"/>
					</TextBlock>

					<TextBlock Text="ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹"
                               Foreground="{DynamicResource TextMuted}"
                               FontSize="13"
                               Margin="0,2,0,0"
                               IsVisible="{Binding LastMessagePreview, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
				</StackPanel>

				<TextBlock Grid.Column="2"
                           Text="{Binding LastMessageDate, Converter={conv:Converter Name=MessageTime}}"
                           Foreground="{DynamicResource TextMuted}"
                           FontSize="11"
                           VerticalAlignment="Top"
                           HorizontalAlignment="Right"
                           Margin="0,4,0,0"/>
			</Grid>
		</DataTemplate>

		<!-- Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð¿Ð¾Ð¸ÑÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ (GlobalSearchMessageDTO) -->
		<DataTemplate x:Key="MessageSearchResultTemplate" x:DataType="shared:GlobalSearchMessageDTO">
			<Grid Height="52" ColumnDefinitions="Auto,*,50">
				<controls:AvatarControl Grid.Column="0"
                                        Classes="Medium"
                                        Source="{Binding ChatAvatar}"
                                        DisplayName="{Binding ChatName}"
                                        FallbackIcon="{StaticResource GroupIcon}"
                                        ShowOnlineIndicator="False"
                                        VerticalAlignment="Center"/>

				<StackPanel Grid.Column="1"
                            VerticalAlignment="Center"
                            Margin="12,0,8,0">
					<TextBlock Text="{Binding ChatName}"
                               FontWeight="SemiBold"
                               FontSize="14"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1"/>

					<TextBlock Foreground="{DynamicResource TextSecondary}"
                               FontSize="13"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1"
                               Margin="0,2,0,0"
                               IsVisible="{Binding HighlightedContent, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
						<Run Text="{Binding SenderName}" Foreground="{DynamicResource Accent}"/>
						<Run Text=": "/>
						<Run Text="{Binding HighlightedContent}"/>
					</TextBlock>

					<TextBlock Text="ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹"
                               Foreground="{DynamicResource TextMuted}"
                               FontSize="13"
                               Margin="0,2,0,0"
                               IsVisible="{Binding HighlightedContent, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
				</StackPanel>

				<TextBlock Grid.Column="2"
                           Text="{Binding CreatedAt, Converter={conv:Converter Name=MessageTime}}"
                           Foreground="{DynamicResource TextMuted}"
                           FontSize="11"
                           VerticalAlignment="Top"
                           HorizontalAlignment="Right"
                           Margin="0,4,0,0"/>
			</Grid>
		</DataTemplate>

		<DataTemplate x:Key="ChatListItemTemplate" x:DataType="shared:ChatDTO">
			<Grid Height="52" ColumnDefinitions="Auto,*,50">
				<controls:AvatarControl Grid.Column="0"
                                        Classes="Medium"
                                        Source="{Binding Avatar}"
                                        DisplayName="{Binding Name}"
                                        FallbackIcon="{StaticResource GroupIcon}"
                                        ShowOnlineIndicator="False"
                                        VerticalAlignment="Center"/>

				<StackPanel Grid.Column="1"
                            VerticalAlignment="Center"
                            Margin="12,0,8,0">
					<TextBlock Text="{Binding Name}"
                               FontWeight="SemiBold"
                               FontSize="14"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1"/>

					<TextBlock Foreground="{DynamicResource TextSecondary}"
                               FontSize="13"
                               TextTrimming="CharacterEllipsis"
                               MaxLines="1"
                               Margin="0,2,0,0"
                               IsVisible="{Binding LastMessagePreview, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
						<Run Text="{Binding LastMessageSenderName}"/>
						<Run Text=": "/>
						<Run Text="{Binding LastMessagePreview}"/>
					</TextBlock>

					<TextBlock Text="ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹"
                               Foreground="{DynamicResource TextMuted}"
                               FontSize="13"
                               Margin="0,2,0,0"
                               IsVisible="{Binding LastMessagePreview, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
				</StackPanel>

				<StackPanel Grid.Column="2"
                            VerticalAlignment="Top"
                            HorizontalAlignment="Right"
                            Margin="0,4,0,0">
					<TextBlock Text="{Binding LastMessageDate, Converter={conv:Converter Name=MessageTime}}"
                               Foreground="{DynamicResource TextMuted}"
                               FontSize="11"
                               HorizontalAlignment="Right"/>

					<Border Classes="UnreadBadge"
                            Margin="0,4,0,0"
                            HorizontalAlignment="Right"
                            IsVisible="{Binding UnreadCount, Converter={conv:Converter Name=GreaterThanZero}}">
						<TextBlock Text="{Binding UnreadCount}"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="White"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
					</Border>
				</StackPanel>
			</Grid>
		</DataTemplate>
	</UserControl.Resources>

	<Grid x:Name="MainGrid">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="280" MaxWidth="400"/>
			<ColumnDefinition Width="Auto"/>
			<ColumnDefinition MinWidth="400"/>
			<ColumnDefinition Width="Auto"/>
		</Grid.ColumnDefinitions>

		<!-- ==================== ÐŸÐÐÐ•Ð›Ð¬ Ð¡ÐŸÐ˜Ð¡ÐšÐ Ð§ÐÐ¢ÐžÐ’ ==================== -->
		<Grid x:Name="ChatListPanel" Grid.Column="0">
			<DockPanel>

				<!-- ==================== Ð—ÐÐ“ÐžÐ›ÐžÐ’ÐžÐš ==================== -->
				<Border DockPanel.Dock="Top"
						Classes="PanelHeader"
						BorderThickness="0,0,0,1"
						BorderBrush="{DynamicResource BorderDefault}">

					<!-- ÐžÐ±Ñ‘Ñ€Ñ‚ÐºÐ° Ð´Ð»Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² -->
					<Panel>
						<!-- ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
						<Grid ColumnDefinitions="*,Auto"
							  IsVisible="{Binding !IsCompactMode, ElementName=Root}">
							<Panel Grid.Column="0">
								<TextBlock Text="{Binding IsGroupMode, Converter={conv:Converter Name=BoolToString}, 
								ConverterParameter='Ð§Ð°Ñ‚Ñ‹|ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹'}"
								Classes="PanelTitle"
								VerticalAlignment="Center"
								IsVisible="{Binding !IsSearchMode}"/>
								<TextBlock Text="ÐŸÐ¾Ð¸ÑÐº"
										   Classes="PanelTitle"
										   VerticalAlignment="Center"
										   IsVisible="{Binding IsSearchMode}"/>
							</Panel>

							<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ñ‡Ð°Ñ‚Ð° -->
							<Button Grid.Column="1"
									Classes="IconButton"
									Command="{Binding CreateGroupCommand}"
									ToolTip.Tip="ÐÐ¾Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚">
								<Button.IsVisible>
									<MultiBinding Converter="{conv:MultiConverter Name=BooleanAnd}">
										<Binding Path="IsGroupMode"/>
										<Binding Path="!IsSearchMode"/>
									</MultiBinding>
								</Button.IsVisible>
								<PathIcon Data="{StaticResource AddIcon}"
										  Width="18" Height="18"
										  Foreground="{DynamicResource Icon}"/>
							</Button>

							<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾Ð¸ÑÐºÐ° -->
							<Button Grid.Column="1"
									Classes="IconButton"
									Command="{Binding CloseSearchCommand}"
									ToolTip.Tip="Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº"
									IsVisible="{Binding IsSearchMode}">
								<PathIcon Data="{StaticResource CloseIcon}"
										  Width="16" Height="16"
										  Foreground="{DynamicResource Icon}"/>
							</Button>
						</Grid>

						<!-- ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - ÐºÐ½Ð¾Ð¿ÐºÐ° Ð¼ÐµÐ½ÑŽ/Ñ€Ð°Ð·Ð²Ð¾Ñ€Ð¾Ñ‚Ð° -->
						<Button Classes="IconButton"
								IsVisible="{Binding IsCompactMode, ElementName=Root}"
								Click="OnExpandButtonClick"
								ToolTip.Tip="Ð Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ"
								HorizontalAlignment="Center">
							<PathIcon Data="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"
									  Width="20" Height="20"
									  Foreground="{DynamicResource Icon}"/>
						</Button>
					</Panel>
				</Border>

				<!-- ==================== ÐŸÐžÐ›Ð• ÐŸÐžÐ˜Ð¡ÐšÐ / ÐšÐÐžÐŸÐšÐ ÐŸÐžÐ˜Ð¡ÐšÐ ==================== -->
				<Border DockPanel.Dock="Top"
                        Margin="8,8,8,8"
                        Height="40">
					<Panel>
						<!-- ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - Ð¿Ð¾Ð»Ðµ Ð¿Ð¾Ð¸ÑÐºÐ° -->
						<Border Classes="SearchContainer"
                                IsVisible="{Binding !IsCompactMode, ElementName=Root}"
                                CornerRadius="8"
                                Height="36">
							<Grid ColumnDefinitions="Auto,*">
								<PathIcon Grid.Column="0"
                                          Data="{StaticResource SearchIcon}"
                                          Width="16" Height="16"
                                          Foreground="{DynamicResource TextMuted}"
                                          Margin="10,0,8,0"/>

								<TextBox x:Name="SearchTextBox"
                                         Grid.Column="1"
                                         Classes="Borderlesses"
                                         Text="{Binding SearchManager.SearchQuery, Mode=TwoWay}"
                                         Watermark="ÐŸÐ¾Ð¸ÑÐº..."
                                         Background="Transparent"
                                         BorderThickness="0"
                                         VerticalContentAlignment="Center"
                                         VerticalAlignment="Center"
                                         Padding="0,0,10,0"
                                         FontSize="13"/>
							</Grid>
						</Border>

						<!-- ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - ÐºÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾Ð¸ÑÐºÐ° -->
						<Button Classes="IconButton CompactSearchButton"
                                IsVisible="{Binding IsCompactMode, ElementName=Root}"
                                Click="OnSearchButtonClick"
                                ToolTip.Tip="ÐŸÐ¾Ð¸ÑÐº"
                                HorizontalAlignment="Center"
                                Width="40" Height="40">
							<PathIcon Data="{StaticResource SearchIcon}"
                                      Width="20" Height="20"
                                      Foreground="{DynamicResource Icon}"/>
						</Button>
					</Panel>
				</Border>

				<!-- ==================== ÐžÐ‘Ð«Ð§ÐÐ«Ð™ Ð¡ÐŸÐ˜Ð¡ÐžÐš Ð§ÐÐ¢ÐžÐ’ ==================== -->
				<ListBox DockPanel.Dock="Top"
                         ItemsSource="{Binding Chats}"
                         SelectedItem="{Binding SelectedChat}"
                         Background="Transparent"
                         Margin="4,4,4,8"
                         BorderThickness="0"
                         HorizontalAlignment="Stretch"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         IsVisible="{Binding !IsSearchMode}">

					<ListBox.ItemsPanel>
						<ItemsPanelTemplate>
							<VirtualizingStackPanel HorizontalAlignment="Stretch"/>
						</ItemsPanelTemplate>
					</ListBox.ItemsPanel>

					<ListBox.Styles>
						<Style Selector="ListBoxItem">
							<Setter Property="HorizontalAlignment" Value="Stretch"/>
							<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
							<Setter Property="Padding" Value="8"/>
							<Setter Property="Margin" Value="0,1"/>
							<Setter Property="CornerRadius" Value="8"/>
							<Setter Property="Background" Value="Transparent"/>
							<Setter Property="Cursor" Value="Hand"/>
						</Style>

						<Style Selector="ListBoxItem:pointerover /template/ ContentPresenter#PART_ContentPresenter">
							<Setter Property="Background" Value="{DynamicResource BorderHover}"/>
						</Style>

						<Style Selector="ListBoxItem:selected /template/ ContentPresenter#PART_ContentPresenter">
							<Setter Property="Background" Value="{DynamicResource Accent}"/>
						</Style>

						<Style Selector="ListBoxItem:selected TextBlock">
							<Setter Property="Foreground" Value="{DynamicResource TextOnAccent}"/>
						</Style>

						<Style Selector="ListBoxItem:selected TextBlock.ChatPreview">
							<Setter Property="Foreground" Value="{DynamicResource TextOnAccent}"/>
							<Setter Property="Opacity" Value="0.85"/>
						</Style>
					</ListBox.Styles>

					<ListBox.ItemTemplate>
						<DataTemplate x:DataType="shared:ChatDTO">
							<Panel>
								<!-- ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ -->
								<Grid Height="52"
									  ColumnDefinitions="Auto,*,Auto"
									  HorizontalAlignment="Stretch"
									  IsVisible="{Binding !IsCompactMode, ElementName=Root}">
									<controls:AvatarControl Grid.Column="0"
															Classes="Medium"
															Source="{Binding Avatar}"
															DisplayName="{Binding Name}"
															FallbackIcon="{StaticResource GroupIcon}"
															ShowOnlineIndicator="False"
															VerticalAlignment="Center"/>

									<StackPanel Grid.Column="1"
												VerticalAlignment="Center"
												Margin="12,0,8,0"
												HorizontalAlignment="Stretch">
										<TextBlock Text="{Binding Name}"
												   FontWeight="SemiBold"
												   FontSize="14"
												   TextTrimming="CharacterEllipsis"
												   MaxLines="1"/>

										<TextBlock Classes="ChatPreview"
												   FontSize="13"
												   TextTrimming="CharacterEllipsis"
												   MaxLines="1"
												   Margin="0,2,0,0"
												   IsVisible="{Binding LastMessagePreview, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
											<Run Text="{Binding LastMessageSenderName}"/>
											<Run Text=": "/>
											<Run Text="{Binding LastMessagePreview}"/>
										</TextBlock>

										<TextBlock Text="ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹"
												   Foreground="{DynamicResource TextMuted}"
												   FontSize="13"
												   Margin="0,2,0,0"
												   IsVisible="{Binding LastMessagePreview, Converter={x:Static StringConverters.IsNullOrEmpty}}"/>
									</StackPanel>

									<StackPanel Grid.Column="2"
												VerticalAlignment="Top"
												HorizontalAlignment="Right"
												Margin="0,4,0,0"
												MinWidth="40">
										<TextBlock Text="{Binding LastMessageDate, Converter={conv:Converter Name=MessageTime}}"
												   Foreground="{DynamicResource TextMuted}"
												   FontSize="11"
												   HorizontalAlignment="Right"/>

										<Border Classes="UnreadBadge"
												Margin="0,4,0,0"
												HorizontalAlignment="Right"
												IsVisible="{Binding UnreadCount, Converter={conv:Converter Name=GreaterThanZero}}">
											<TextBlock Text="{Binding UnreadCount}"
													   FontSize="11"
													   FontWeight="SemiBold"
													   Foreground="White"
													   HorizontalAlignment="Center"
													   VerticalAlignment="Center"/>
										</Border>
									</StackPanel>
								</Grid>

								<!-- ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð°Ð²Ð°Ñ‚Ð°Ñ€ Ñ tooltip -->
								<Grid Height="52"
									  IsVisible="{Binding IsCompactMode, ElementName=Root}"
									  HorizontalAlignment="Center"
									  ToolTip.Tip="{Binding Name}">
									<Panel>
										<controls:AvatarControl Classes="Medium"
																Source="{Binding Avatar}"
																DisplayName="{Binding Name}"
																FallbackIcon="{StaticResource GroupIcon}"
																ShowOnlineIndicator="False"
																VerticalAlignment="Center"
																HorizontalAlignment="Center"/>

										<!-- Ð‘ÐµÐ¹Ð´Ð¶ Ð½ÐµÐ¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ñ… Ð² ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ -->
										<Border Classes="UnreadBadge CompactBadge"
												HorizontalAlignment="Right"
												VerticalAlignment="Top"
												Margin="0,-2,-6,0"
												MinWidth="18"
												Height="18"
												IsVisible="{Binding UnreadCount, Converter={conv:Converter Name=GreaterThanZero}}">
											<TextBlock Text="{Binding UnreadCount}"
													   FontSize="10"
													   FontWeight="SemiBold"
													   Foreground="White"
													   HorizontalAlignment="Center"
													   VerticalAlignment="Center"/>
										</Border>
									</Panel>
								</Grid>
							</Panel>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>

				<!-- ==================== Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢Ð« ÐŸÐžÐ˜Ð¡ÐšÐ ==================== -->
				<ScrollViewer Classes="ThinScrollbar AutoHideScrollbar"
                              IsVisible="{Binding IsSearchMode}"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
					<StackPanel Margin="8,4,8,8"
                                Width="{Binding $parent[ScrollViewer].Bounds.Width}">

						<!-- ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ñ‡Ð°Ñ‚Ñ‹ -->
						<StackPanel IsVisible="{Binding SearchManager.HasChatResults}">
							<TextBlock Classes="SectionHeader"
                                       Text="Ð§Ð°Ñ‚Ñ‹"
                                       IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>

							<ItemsControl Classes="ChatList"
                                          ItemsSource="{Binding SearchManager.ChatResults}">
								<ItemsControl.ItemTemplate>
									<DataTemplate x:DataType="shared:ChatDTO">
										<Button Classes="ChatListItem"
                                                Margin="0,1"
                                                Command="{Binding $parent[UserControl].((vm:ChatsViewModel)DataContext).OpenSearchedChatCommand}"
                                                CommandParameter="{Binding}">
											<Panel>
												<!-- ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ -->
												<ContentPresenter Content="{Binding}"
                                                                  ContentTemplate="{StaticResource ChatSearchResultTemplate}"
                                                                  IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
												<!-- ÐšÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ -->
												<controls:AvatarControl Classes="Medium"
                                                                        Source="{Binding Avatar}"
                                                                        DisplayName="{Binding Name}"
                                                                        FallbackIcon="{StaticResource GroupIcon}"
                                                                        ShowOnlineIndicator="False"
                                                                        HorizontalAlignment="Center"
                                                                        IsVisible="{Binding IsCompactMode, ElementName=Root}"/>
											</Panel>
										</Button>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</StackPanel>

						<!-- Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ -->
						<Border Height="1"
                                Background="{DynamicResource BorderDefault}"
                                Margin="0,12,0,8"
                                >
							<Border.IsVisible>
								<MultiBinding Converter="{conv:MultiConverter Name=BooleanAnd}">
									<Binding Path="SearchManager.HasChatResults"/>
									<Binding Path="SearchManager.HasMessageResults"/>
									<Binding Path="!IsCompactMode" ElementName="Root"/>
								</MultiBinding>
							</Border.IsVisible>
						</Border>

						<!-- ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ) -->
						<StackPanel>
							<StackPanel.IsVisible>
								<MultiBinding Converter="{conv:MultiConverter Name=BooleanAnd}">
									<Binding Path="SearchManager.HasMessageResults"/>
									<Binding Path="!IsCompactMode" ElementName="Root"/>
								</MultiBinding>
							</StackPanel.IsVisible>

							<StackPanel Orientation="Horizontal">
								<TextBlock Classes="SectionHeader" Text="Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"/>
								<TextBlock FontSize="12"
                                           Foreground="{DynamicResource TextMuted}"
                                           Margin="4,8,0,6"
                                           VerticalAlignment="Center">
									<Run Text="("/>
									<Run Text="{Binding SearchManager.TotalMessagesCount}"/>
									<Run Text=")"/>
								</TextBlock>
							</StackPanel>

							<ItemsControl Classes="ChatList"
                                          ItemsSource="{Binding SearchManager.MessageResults}">
								<ItemsControl.ItemTemplate>
									<DataTemplate x:DataType="shared:GlobalSearchMessageDTO">
										<Button Classes="ChatListItem"
                                                Margin="0,1"
                                                Command="{Binding $parent[UserControl].((vm:ChatsViewModel)DataContext).OpenSearchResultCommand}"
                                                CommandParameter="{Binding}">
											<ContentPresenter Content="{Binding}"
                                                              ContentTemplate="{StaticResource MessageSearchResultTemplate}"/>
										</Button>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>

							<!-- ÐšÐ½Ð¾Ð¿ÐºÐ° "ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐµÑ‰Ñ‘" -->
							<Button Content="ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐµÑ‰Ñ‘..."
                                    HorizontalAlignment="Center"
                                    Margin="0,16,0,8"
                                    Padding="20,10"
                                    Background="{DynamicResource SecondaryBG}"
                                    Foreground="{DynamicResource TextSecondary}"
                                    CornerRadius="8"
                                    FontSize="13"
                                    Cursor="Hand"
                                    IsVisible="{Binding SearchManager.HasMoreMessages}"
                                    Command="{Binding LoadMoreSearchResultsCommand}"/>
						</StackPanel>

						<!-- ==================== ÐŸÐ£Ð¡Ð¢ÐžÐ• Ð¡ÐžÐ¡Ð¢ÐžÐ¯ÐÐ˜Ð• / Ð—ÐÐ“Ð Ð£Ð—ÐšÐ ==================== -->
						<StackPanel HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Margin="0,48"
                                    IsVisible="{Binding !SearchManager.HasResults}">

							<!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ (ÐºÑ€ÑƒÐ³Ð¾Ð²Ð¾Ð¹) -->
							<StackPanel Spacing="12"
                                        HorizontalAlignment="Center"
                                        IsVisible="{Binding SearchManager.IsSearching}">
								<controls:CircularProgress IsIndeterminate="True"
                                                           Size="48"
                                                           StrokeWidth="4"
                                                           Foreground="{DynamicResource Accent}"
                                                           HorizontalAlignment="Center"/>
								<TextBlock Text="ÐŸÐ¾Ð¸ÑÐº..."
                                           FontSize="14"
                                           Foreground="{DynamicResource TextSecondary}"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
							</StackPanel>

							<!-- ÐšÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»Ðµ Ð¿ÑƒÑÑ‚Ð¾Ðµ -->
							<StackPanel Spacing="8"
                                        HorizontalAlignment="Center">
								<StackPanel.IsVisible>
									<MultiBinding Converter="{conv:MultiConverter Name=BooleanAnd}">
										<Binding Path="!SearchManager.IsSearching"/>
										<Binding Path="SearchManager.SearchQuery" Converter="{x:Static StringConverters.IsNullOrEmpty}"/>
									</MultiBinding>
								</StackPanel.IsVisible>
								<PathIcon Data="{StaticResource SearchIcon}"
                                          Width="48" Height="48"
                                          Foreground="{DynamicResource TextMuted}"
                                          Opacity="0.3"
                                          HorizontalAlignment="Center"/>
								<TextBlock Text="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ñ"
                                           FontSize="14"
                                           Foreground="{DynamicResource TextSecondary}"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
								<TextBlock Text="ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑÐ¼ Ñ‡Ð°Ñ‚Ð¾Ð² Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÐ¼"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextMuted}"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
							</StackPanel>

							<!-- ÐšÐ¾Ð³Ð´Ð° Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ -->
							<StackPanel Spacing="8"
                                        HorizontalAlignment="Center">
								<StackPanel.IsVisible>
									<MultiBinding Converter="{conv:MultiConverter Name=BooleanAnd}">
										<Binding Path="!SearchManager.IsSearching"/>
										<Binding Path="SearchManager.SearchQuery" Converter="{x:Static StringConverters.IsNotNullOrEmpty}"/>
									</MultiBinding>
								</StackPanel.IsVisible>
								<TextBlock Text="ðŸ˜”"
                                           FontSize="48"
                                           HorizontalAlignment="Center"/>
								<TextBlock Text="ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾"
                                           FontSize="14"
                                           Foreground="{DynamicResource TextSecondary}"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
								<TextBlock Text="ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextMuted}"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
							</StackPanel>
						</StackPanel>

						<!-- ÐžÑˆÐ¸Ð±ÐºÐ° -->
						<Border Classes="AlertError"
                                Margin="0,8"
                                IsVisible="{Binding SearchManager.ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
							<TextBlock Text="{Binding SearchManager.ErrorMessage}"
                                       Foreground="{DynamicResource ErrorBrush}"
                                       FontSize="13"
                                       TextWrapping="Wrap"
                                       IsVisible="{Binding !IsCompactMode, ElementName=Root}"/>
						</Border>
					</StackPanel>
				</ScrollViewer>
			</DockPanel>
		</Grid>

		<!-- ==================== Ð ÐÐ—Ð”Ð•Ð›Ð˜Ð¢Ð•Ð›Ð¬ ==================== -->
		<GridSplitter x:Name="GridSplitter"
                      Grid.Column="1"
                      Width="4"
                      ResizeDirection="Columns"
                      Background="Transparent"
                      ResizeBehavior="PreviousAndNext"/>

		<!-- ==================== ÐžÐ‘Ð›ÐÐ¡Ð¢Ð¬ Ð§ÐÐ¢Ð ==================== -->
		<Border Grid.Column="2"
                CornerRadius="16"
                Background="{DynamicResource SecondaryBG}"
                BorderBrush="{DynamicResource BorderDefault}"
                BorderThickness="1"
                ClipToBounds="True">

			<Panel>
				<ContentControl Content="{Binding CurrentChatViewModel}"/>

				<StackPanel VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            IsVisible="{Binding SelectedChat, Converter={x:Static ObjectConverters.IsNull}}">

					<PathIcon Data="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"
                              Width="64" Height="64"
                              Foreground="{DynamicResource TextMuted}"
                              Opacity="0.5"/>

					<TextBlock Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‡Ð°Ñ‚"
                               FontSize="18"
                               FontWeight="Medium"
                               Foreground="{DynamicResource TextMuted}"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0"/>

					<TextBlock Text="Ð¸Ð»Ð¸ Ð½Ð°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð´Ð¸Ð°Ð»Ð¾Ð³"
                               FontSize="14"
                               Foreground="{DynamicResource TextMuted}"
                               Opacity="0.7"
                               HorizontalAlignment="Center"
                               Margin="0,4,0,0"/>
				</StackPanel>
			</Panel>
		</Border>

		<!-- ==================== ÐŸÐÐÐ•Ð›Ð¬ Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð˜ ==================== -->
		<views:ChatInfoPanel x:Name="InfoPanel"
                             Grid.Column="3"
                             DataContext="{Binding CurrentChatViewModel}"/>
	</Grid>
</UserControl>